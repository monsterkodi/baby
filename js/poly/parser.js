// koffee 1.6.0

/*
00000000    0000000   00000000    0000000  00000000  00000000   
000   000  000   000  000   000  000       000       000   000  
00000000   000000000  0000000    0000000   0000000   0000000    
000        000   000  000   000       000  000       000   000  
000        000   000  000   000  0000000   00000000  000   000
 */
var PEG, add, basemap, generate, klog, opmap, parser, poly, recenter, ref, replacements, rescale, topo;

klog = require('kxk').klog;

ref = require('./geo'), add = ref.add, recenter = ref.recenter, rescale = ref.rescale;

poly = require('./poly');

topo = require('./topo');

PEG = require('pegjs');

parser = PEG.generate("start  = opspec+\n\nopspec \n    = lettr:opcode args:opargs {return {\"op\":lettr,\"args\":args};}\n    / lettr:opcode float:float {return {\"op\":lettr,\"args\":[float]};}\n    / lettr:opcode             {return {\"op\":lettr,\"args\":[]};}\n\nopargs = \"(\"\n         num:( float:float \",\"? {return float} )+\n         \")\" {return num;}\n\nopcode = op:[a-zA-Z] {return op;}\n\nint   = digits:[0-9-]+   { return parseInt(digits.join(\"\"), 10); }\nfloat = digits:[0-9.-]+  { return parseFloat(digits.join(\"\"), 10); }");

basemap = {
    T: poly.tetrahedron,
    O: poly.octahedron,
    C: poly.cube,
    I: poly.icosahedron,
    D: poly.dodecahedron,
    P: poly.prism,
    A: poly.antiprism,
    Y: poly.pyramid,
    J: poly.johnson,
    U: poly.cupola,
    V: poly.anticupola
};

opmap = {
    d: topo.dual,
    a: topo.ambo,
    k: topo.kis,
    g: topo.gyro,
    p: topo.propellor,
    r: topo.reflect,
    c: topo.chamfer,
    w: topo.whirl,
    n: topo.inset,
    x: topo.extrude,
    l: topo.loft,
    P: topo.perspectiva,
    q: topo.quinto,
    u: topo.trisub,
    H: topo.hollow,
    C: topo.canonicalize,
    A: topo.adjustXY
};

replacements = [[/e/g, 'aa'], [/b/g, 'ta'], [/o/g, 'jj'], [/m/g, 'kj'], [/t(\d*)/g, 'dk$1d'], [/j/g, 'dad'], [/s/g, 'dgd'], [/dd/g, ''], [/ad/g, 'a'], [/gd/g, 'g'], [/aO/g, 'aC'], [/aI/g, 'aD'], [/gO/g, 'gC'], [/gI/g, 'gD']];

generate = function(notation) {
    var baseargs, basefunc, dispatch, equiv, expanded, i, j, len, len1, op, opargs, opfunc, oplist, orig, ref1;
    dispatch = function(fn, arg) {
        return fn.apply(fn, arg || []);
    };
    expanded = notation;
    for (i = 0, len = replacements.length; i < len; i++) {
        ref1 = replacements[i], orig = ref1[0], equiv = ref1[1];
        expanded = expanded.replace(orig, equiv);
    }
    oplist = parser.parse(expanded).reverse();
    op = oplist.shift();
    basefunc = basemap[op['op']];
    baseargs = op['args'];
    poly = dispatch(basefunc, baseargs);
    for (j = 0, len1 = oplist.length; j < len1; j++) {
        op = oplist[j];
        opfunc = opmap[op['op']];
        opargs = [poly].concat(op['args']);
        poly = dispatch(opfunc, opargs);
    }
    poly.vertex = poly.vertices;
    poly.face = poly.faces;
    return poly;
};

module.exports = {
    generate: generate
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2VyLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQTs7QUFpQkUsT0FBUyxPQUFBLENBQVEsS0FBUjs7QUFDWCxNQUE2QixPQUFBLENBQVEsT0FBUixDQUE3QixFQUFFLGFBQUYsRUFBTyx1QkFBUCxFQUFpQjs7QUFFakIsSUFBQSxHQUFPLE9BQUEsQ0FBUSxRQUFSOztBQUNQLElBQUEsR0FBTyxPQUFBLENBQVEsUUFBUjs7QUFDUCxHQUFBLEdBQU8sT0FBQSxDQUFRLE9BQVI7O0FBRVAsTUFBQSxHQUFTLEdBQUcsQ0FBQyxRQUFKLENBQWEsNmdCQUFiOztBQWtCVCxPQUFBLEdBQ0k7SUFBQSxDQUFBLEVBQUcsSUFBSSxDQUFDLFdBQVI7SUFDQSxDQUFBLEVBQUcsSUFBSSxDQUFDLFVBRFI7SUFFQSxDQUFBLEVBQUcsSUFBSSxDQUFDLElBRlI7SUFHQSxDQUFBLEVBQUcsSUFBSSxDQUFDLFdBSFI7SUFJQSxDQUFBLEVBQUcsSUFBSSxDQUFDLFlBSlI7SUFLQSxDQUFBLEVBQUcsSUFBSSxDQUFDLEtBTFI7SUFNQSxDQUFBLEVBQUcsSUFBSSxDQUFDLFNBTlI7SUFPQSxDQUFBLEVBQUcsSUFBSSxDQUFDLE9BUFI7SUFRQSxDQUFBLEVBQUcsSUFBSSxDQUFDLE9BUlI7SUFTQSxDQUFBLEVBQUcsSUFBSSxDQUFDLE1BVFI7SUFVQSxDQUFBLEVBQUcsSUFBSSxDQUFDLFVBVlI7OztBQVlKLEtBQUEsR0FDSTtJQUFBLENBQUEsRUFBRyxJQUFJLENBQUMsSUFBUjtJQUNBLENBQUEsRUFBRyxJQUFJLENBQUMsSUFEUjtJQUVBLENBQUEsRUFBRyxJQUFJLENBQUMsR0FGUjtJQUdBLENBQUEsRUFBRyxJQUFJLENBQUMsSUFIUjtJQUlBLENBQUEsRUFBRyxJQUFJLENBQUMsU0FKUjtJQUtBLENBQUEsRUFBRyxJQUFJLENBQUMsT0FMUjtJQU1BLENBQUEsRUFBRyxJQUFJLENBQUMsT0FOUjtJQU9BLENBQUEsRUFBRyxJQUFJLENBQUMsS0FQUjtJQVFBLENBQUEsRUFBRyxJQUFJLENBQUMsS0FSUjtJQVNBLENBQUEsRUFBRyxJQUFJLENBQUMsT0FUUjtJQVVBLENBQUEsRUFBRyxJQUFJLENBQUMsSUFWUjtJQVdBLENBQUEsRUFBRyxJQUFJLENBQUMsV0FYUjtJQVlBLENBQUEsRUFBRyxJQUFJLENBQUMsTUFaUjtJQWFBLENBQUEsRUFBRyxJQUFJLENBQUMsTUFiUjtJQWNBLENBQUEsRUFBRyxJQUFJLENBQUMsTUFkUjtJQWVBLENBQUEsRUFBRyxJQUFJLENBQUMsWUFmUjtJQWdCQSxDQUFBLEVBQUcsSUFBSSxDQUFDLFFBaEJSOzs7QUFrQkosWUFBQSxHQUFlLENBQ1gsQ0FBQyxJQUFELEVBQVksSUFBWixDQURXLEVBRVgsQ0FBQyxJQUFELEVBQVksSUFBWixDQUZXLEVBR1gsQ0FBQyxJQUFELEVBQVksSUFBWixDQUhXLEVBSVgsQ0FBQyxJQUFELEVBQVksSUFBWixDQUpXLEVBS1gsQ0FBQyxTQUFELEVBQVksT0FBWixDQUxXLEVBTVgsQ0FBQyxJQUFELEVBQVksS0FBWixDQU5XLEVBT1gsQ0FBQyxJQUFELEVBQVksS0FBWixDQVBXLEVBUVgsQ0FBQyxLQUFELEVBQVksRUFBWixDQVJXLEVBU1gsQ0FBQyxLQUFELEVBQVksR0FBWixDQVRXLEVBVVgsQ0FBQyxLQUFELEVBQVksR0FBWixDQVZXLEVBV1gsQ0FBQyxLQUFELEVBQVksSUFBWixDQVhXLEVBWVgsQ0FBQyxLQUFELEVBQVksSUFBWixDQVpXLEVBYVgsQ0FBQyxLQUFELEVBQVksSUFBWixDQWJXLEVBY1gsQ0FBQyxLQUFELEVBQVksSUFBWixDQWRXOztBQXVCZixRQUFBLEdBQVcsU0FBQyxRQUFEO0FBRVAsUUFBQTtJQUFBLFFBQUEsR0FBVyxTQUFDLEVBQUQsRUFBSyxHQUFMO2VBQWEsRUFBRSxDQUFDLEtBQUgsQ0FBUyxFQUFULEVBQWEsR0FBQSxJQUFPLEVBQXBCO0lBQWI7SUFFWCxRQUFBLEdBQVc7QUFDWCxTQUFBLDhDQUFBO2dDQUFLLGdCQUFLO1FBQ04sUUFBQSxHQUFXLFFBQVEsQ0FBQyxPQUFULENBQWlCLElBQWpCLEVBQXVCLEtBQXZCO0FBRGY7SUFJQSxNQUFBLEdBQVMsTUFBTSxDQUFDLEtBQVAsQ0FBYSxRQUFiLENBQXNCLENBQUMsT0FBdkIsQ0FBQTtJQUVULEVBQUEsR0FBSyxNQUFNLENBQUMsS0FBUCxDQUFBO0lBQ0wsUUFBQSxHQUFXLE9BQVEsQ0FBQSxFQUFHLENBQUEsSUFBQSxDQUFIO0lBQ25CLFFBQUEsR0FBVyxFQUFHLENBQUEsTUFBQTtJQUNkLElBQUEsR0FBTyxRQUFBLENBQVMsUUFBVCxFQUFtQixRQUFuQjtBQUVQLFNBQUEsMENBQUE7O1FBQ0ksTUFBQSxHQUFTLEtBQU0sQ0FBQSxFQUFHLENBQUEsSUFBQSxDQUFIO1FBQ2YsTUFBQSxHQUFTLENBQUMsSUFBRCxDQUFNLENBQUMsTUFBUCxDQUFjLEVBQUcsQ0FBQSxNQUFBLENBQWpCO1FBQ1QsSUFBQSxHQUFTLFFBQUEsQ0FBUyxNQUFULEVBQWlCLE1BQWpCO0FBSGI7SUFRQSxJQUFJLENBQUMsTUFBTCxHQUFjLElBQUksQ0FBQztJQUNuQixJQUFJLENBQUMsSUFBTCxHQUFjLElBQUksQ0FBQztXQUNuQjtBQTFCTzs7QUE0QlgsTUFBTSxDQUFDLE9BQVAsR0FDSTtJQUFBLFFBQUEsRUFBUyxRQUFUIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAwICAgXG4wMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgXG4wMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgXG4wMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgXG4wMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4jIyNcbiMgUG9seWjDqWRyb25pc21lXG4jPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4jXG4jIEEgdG95IGZvciBjb25zdHJ1Y3RpbmcgYW5kIG1hbmlwdWxhdGluZyBwb2x5aGVkcmEgYW5kIG90aGVyIG1lc2hlc1xuI1xuIyBDb3B5cmlnaHQgMjAxOSwgQW5zZWxtIExldnNrYXlhXG4jIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZVxuI1xuIz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIFxueyBrbG9nIH0gPSByZXF1aXJlICdreGsnXG57IGFkZCwgcmVjZW50ZXIsIHJlc2NhbGUgfSA9IHJlcXVpcmUgJy4vZ2VvJ1xuXG5wb2x5ID0gcmVxdWlyZSAnLi9wb2x5J1xudG9wbyA9IHJlcXVpcmUgJy4vdG9wbydcblBFRyAgPSByZXF1aXJlICdwZWdqcydcbiAgICBcbnBhcnNlciA9IFBFRy5nZW5lcmF0ZSBcIlwiXCJcbiAgICBzdGFydCAgPSBvcHNwZWMrXG4gICAgXG4gICAgb3BzcGVjIFxuICAgICAgICA9IGxldHRyOm9wY29kZSBhcmdzOm9wYXJncyB7cmV0dXJuIHtcIm9wXCI6bGV0dHIsXCJhcmdzXCI6YXJnc307fVxuICAgICAgICAvIGxldHRyOm9wY29kZSBmbG9hdDpmbG9hdCB7cmV0dXJuIHtcIm9wXCI6bGV0dHIsXCJhcmdzXCI6W2Zsb2F0XX07fVxuICAgICAgICAvIGxldHRyOm9wY29kZSAgICAgICAgICAgICB7cmV0dXJuIHtcIm9wXCI6bGV0dHIsXCJhcmdzXCI6W119O31cbiAgICBcbiAgICBvcGFyZ3MgPSBcIihcIlxuICAgICAgICAgICAgIG51bTooIGZsb2F0OmZsb2F0IFwiLFwiPyB7cmV0dXJuIGZsb2F0fSApK1xuICAgICAgICAgICAgIFwiKVwiIHtyZXR1cm4gbnVtO31cbiAgICBcbiAgICBvcGNvZGUgPSBvcDpbYS16QS1aXSB7cmV0dXJuIG9wO31cbiAgICBcbiAgICBpbnQgICA9IGRpZ2l0czpbMC05LV0rICAgeyByZXR1cm4gcGFyc2VJbnQoZGlnaXRzLmpvaW4oXCJcIiksIDEwKTsgfVxuICAgIGZsb2F0ID0gZGlnaXRzOlswLTkuLV0rICB7IHJldHVybiBwYXJzZUZsb2F0KGRpZ2l0cy5qb2luKFwiXCIpLCAxMCk7IH1cbiAgICBcIlwiXCJcblxuYmFzZW1hcCA9IFxuICAgIFQ6IHBvbHkudGV0cmFoZWRyb25cbiAgICBPOiBwb2x5Lm9jdGFoZWRyb25cbiAgICBDOiBwb2x5LmN1YmVcbiAgICBJOiBwb2x5Lmljb3NhaGVkcm9uXG4gICAgRDogcG9seS5kb2RlY2FoZWRyb25cbiAgICBQOiBwb2x5LnByaXNtICAgICAgIyBuXG4gICAgQTogcG9seS5hbnRpcHJpc20gICMgblxuICAgIFk6IHBvbHkucHlyYW1pZCAgICAjIG5cbiAgICBKOiBwb2x5LmpvaG5zb24gICAgIyBuXG4gICAgVTogcG9seS5jdXBvbGEgICAgICMgblxuICAgIFY6IHBvbHkuYW50aWN1cG9sYSAjIG5cbiAgICAgICAgXG5vcG1hcCA9XG4gICAgZDogdG9wby5kdWFsXG4gICAgYTogdG9wby5hbWJvXG4gICAgazogdG9wby5raXNcbiAgICBnOiB0b3BvLmd5cm9cbiAgICBwOiB0b3BvLnByb3BlbGxvclxuICAgIHI6IHRvcG8ucmVmbGVjdFxuICAgIGM6IHRvcG8uY2hhbWZlclxuICAgIHc6IHRvcG8ud2hpcmxcbiAgICBuOiB0b3BvLmluc2V0XG4gICAgeDogdG9wby5leHRydWRlXG4gICAgbDogdG9wby5sb2Z0XG4gICAgUDogdG9wby5wZXJzcGVjdGl2YVxuICAgIHE6IHRvcG8ucXVpbnRvXG4gICAgdTogdG9wby50cmlzdWJcbiAgICBIOiB0b3BvLmhvbGxvd1xuICAgIEM6IHRvcG8uY2Fub25pY2FsaXplXG4gICAgQTogdG9wby5hZGp1c3RYWVxuXG5yZXBsYWNlbWVudHMgPSBbXG4gICAgWy9lL2csICAgICAgJ2FhJ10gICAgIyBlICAgIC0+IGFhICAgZXhwbG9kZVxuICAgIFsvYi9nLCAgICAgICd0YSddICAgICMgYiAgICAtPiB0YSAgIGJldmVsXG4gICAgWy9vL2csICAgICAgJ2pqJ10gICAgIyBvICAgIC0+IGpqICAgb3J0aG9cbiAgICBbL20vZywgICAgICAna2onXSAgICAjIG0gICAgLT4ga2ogICBtZXRhXG4gICAgWy90KFxcZCopL2csICdkayQxZCddICMgdChuKSAtPiBkayhuKWRcbiAgICBbL2ovZywgICAgICAnZGFkJ10gICAjIGogICAgLT4gZGFkICBcbiAgICBbL3MvZywgICAgICAnZGdkJ10gICAjIHMgICAgLT4gZGdkICBcbiAgICBbL2RkL2csICAgICAnJ10gICAgICAjIGRkICAgLT4gXG4gICAgWy9hZC9nLCAgICAgJ2EnXSAgICAgIyBhZCAgIC0+IGEgICBcbiAgICBbL2dkL2csICAgICAnZyddICAgICAjIGdkICAgLT4gZyAgIFxuICAgIFsvYU8vZywgICAgICdhQyddICAgICMgYU8gICAtPiBhQyAgXG4gICAgWy9hSS9nLCAgICAgJ2FEJ10gICAgIyBhSSAgIC0+IGFEICBcbiAgICBbL2dPL2csICAgICAnZ0MnXSAgICAjIGdPICAgLT4gZ0MgIFxuICAgIFsvZ0kvZywgICAgICdnRCddICAgICMgZ0kgICAtPiBnRCAgXG5dXG5cbiMgIDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMDBcbiMgMDAwICAgICAgICAwMDAgICAgICAgMDAwMCAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICBcbiMgMDAwICAwMDAwICAwMDAwMDAwICAgMDAwIDAgMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCBcbiMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAwMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICBcbiMgIDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMDBcblxuZ2VuZXJhdGUgPSAobm90YXRpb24pIC0+ICMgY3JlYXRlIHBvbHloZWRyb24gZnJvbSBub3RhdGlvblxuICBcbiAgICBkaXNwYXRjaCA9IChmbiwgYXJnKSAtPiBmbi5hcHBseSBmbiwgYXJnIG9yIFtdXG4gICAgXG4gICAgZXhwYW5kZWQgPSBub3RhdGlvblxuICAgIGZvciBbb3JpZyxlcXVpdl0gaW4gcmVwbGFjZW1lbnRzXG4gICAgICAgIGV4cGFuZGVkID0gZXhwYW5kZWQucmVwbGFjZSBvcmlnLCBlcXVpdlxuICAgICMga2xvZyBcIiN7bm90YXRpb259IC0+ICN7ZXhwYW5kZWR9XCJcbiAgICBcbiAgICBvcGxpc3QgPSBwYXJzZXIucGFyc2UoZXhwYW5kZWQpLnJldmVyc2UoKVxuICBcbiAgICBvcCA9IG9wbGlzdC5zaGlmdCgpXG4gICAgYmFzZWZ1bmMgPSBiYXNlbWFwW29wWydvcCddXVxuICAgIGJhc2VhcmdzID0gb3BbJ2FyZ3MnXVxuICAgIHBvbHkgPSBkaXNwYXRjaCBiYXNlZnVuYywgYmFzZWFyZ3NcbiAgXG4gICAgZm9yIG9wIGluIG9wbGlzdFxuICAgICAgICBvcGZ1bmMgPSBvcG1hcFtvcFsnb3AnXV1cbiAgICAgICAgb3BhcmdzID0gW3BvbHldLmNvbmNhdCBvcFsnYXJncyddXG4gICAgICAgIHBvbHkgICA9IGRpc3BhdGNoIG9wZnVuYywgb3BhcmdzXG4gIFxuICAgICMgcG9seS52ZXJ0aWNlcyA9IHJlY2VudGVyIHBvbHkudmVydGljZXMsIHBvbHkuZWRnZXMoKVxuICAgICMgcG9seS52ZXJ0aWNlcyA9IHJlc2NhbGUgIHBvbHkudmVydGljZXNcbiAgXG4gICAgcG9seS52ZXJ0ZXggPSBwb2x5LnZlcnRpY2VzXG4gICAgcG9seS5mYWNlICAgPSBwb2x5LmZhY2VzXG4gICAgcG9seSAjLmNvbG9yaXplKClcblxubW9kdWxlLmV4cG9ydHMgPSBcbiAgICBnZW5lcmF0ZTpnZW5lcmF0ZSJdfQ==
//# sourceURL=../../coffee/poly/parser.coffee