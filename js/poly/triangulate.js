// koffee 1.6.0

/*
000000000  00000000   000   0000000   000   000   0000000   000   000  000       0000000   000000000  00000000  
   000     000   000  000  000   000  0000  000  000        000   000  000      000   000     000     000       
   000     0000000    000  000000000  000 0 000  000  0000  000   000  000      000000000     000     0000000   
   000     000   000  000  000   000  000  0000  000   000  000   000  000      000   000     000     000       
   000     000   000  000  000   000  000   000   0000000    0000000   0000000  000   000     000     00000000
 */
var Polyhedron, diagsToTris, getDiagonals, triEq, triangulate;

Polyhedron = require('./polyhedron').Polyhedron;

getDiagonals = function(verts) {
    var Area2, Between, Collinear, Diagonal, Diagonalie, InCone, Intersect, IntersectProp, Left, LeftOn, XOR, broke, diagonals, ear, facelen, head, k, limiter, n, origIdx, results, v0, v1, v2, v3, v4, y, z;
    limiter = 999;
    diagonals = [];
    ear = [];
    facelen = verts.length;
    XOR = function(x, y) {
        return (x || y) && !(x && y);
    };
    Area2 = function(Va, Vb, Vc) {
        return ((Vb[0] - Va[0]) * (Vc[1] - Va[1])) - ((Vc[0] - Va[0]) * (Vb[1] - Va[1]));
    };
    Left = function(Va, Vb, Vc) {
        return Area2(Va, Vb, Vc) > 0;
    };
    LeftOn = function(Va, Vb, Vc) {
        return Area2(Va, Vb, Vc) >= 0;
    };
    Collinear = function(Va, Vb, Vc) {
        return Area2(Va, Vb, Vc) === 0;
    };
    Between = function(Va, Vb, Vc) {
        if (Collinear(Va, Vb, Vc)) {
            return false;
        }
        if (Va[0] !== Vb[0]) {
            return ((Va[0] <= Vc[0]) && (Vc[0] <= Vb[0])) || ((Va[0] >= Vc[0]) && (Vc[0] >= Vb[0]));
        } else {
            return ((Va[1] <= Vc[1]) && (Vc[1] <= Vb[1])) || ((Va[1] >= Vc[1]) && (Vc[1] >= Vb[1]));
        }
    };
    IntersectProp = function(Va, Vb, Vc, Vd) {
        if (Collinear(Va, Vb, Vc) || Collinear(Va, Vb, Vd) || Collinear(Vc, Vd, Va) || Collinear(Vc, Vd, Vb)) {
            return false;
        }
        return XOR(Left(Va, Vb, Vc), Left(Va, Vb, Vd)) && XOR(Left(Vc, Vd, Va), Left(Vc, Vd, Vb));
    };
    Intersect = function(Va, Vb, Vc, Vd) {
        if (IntersectProp(Va, Vb, Vc, Vd)) {
            return true;
        } else {
            return Between(Va, Vb, Vc) || Between(Va, Vb, Vd) || Between(Vc, Vd, Va) || Between(Vc, Vd, Vb);
        }
    };
    InCone = function(a, b) {
        var a0, a1;
        a1 = (a + 1 + facelen) % facelen;
        a0 = ((a - 1) + facelen) % facelen;
        if (LeftOn(verts[a], verts[a1], verts[a0])) {
            return Left(verts[a], verts[b], verts[a0]) && Left(verts[b], verts[a], verts[a1]);
        }
        return !(LeftOn(verts[a], verts[b], verts[a1]) && LeftOn(verts[b], verts[a], verts[a0]));
    };
    Diagonalie = function(a, b) {
        var c, c1;
        c = 0;
        while (true) {
            c1 = (c + 1 + facelen) % facelen;
            if ((c !== a) && (c1 !== a) && (c !== b) && (c1 !== b) && IntersectProp(verts[a], verts[b], verts[c], verts[c1])) {
                return false;
            }
            c = (c + 1 + facelen) % facelen;
            if (c === 0) {
                break;
            }
        }
        return true;
    };
    Diagonal = function(a, b) {
        return InCone(a, b) && InCone(b, a) && Diagonalie(a, b);
    };
    v1 = 0;
    while (true) {
        v2 = (v1 + 1 + facelen) % facelen;
        v0 = ((v1 - 1) + facelen) % facelen;
        ear[v1] = Diagonal(v0, v2);
        v1 = (v1 + 1 + facelen) % facelen;
        if (v1 === 0) {
            break;
        }
    }
    origIdx = (function() {
        results = [];
        for (var k = 0; 0 <= facelen ? k < facelen : k > facelen; 0 <= facelen ? k++ : k--){ results.push(k); }
        return results;
    }).apply(this);
    n = facelen;
    z = limiter;
    head = 0;
    while ((z > 0) && (n > 3)) {
        z -= 1;
        v2 = head;
        y = limiter;
        while (true) {
            y -= 1;
            broke = false;
            if (ear[v2]) {
                v3 = (v2 + 1 + facelen) % facelen;
                v4 = (v3 + 1 + facelen) % facelen;
                v1 = ((v2 - 1) + facelen) % facelen;
                v0 = ((v1 - 1) + facelen) % facelen;
                diagonals.push([origIdx[v1], origIdx[v3]]);
                ear[v1] = Diagonal(v0, v3);
                ear[v3] = Diagonal(v1, v4);
                verts = verts.slice(0, +v2 + 1 || void 0).concat(verts.slice(v3));
                origIdx = origIdx.slice(0, +v2 + 1 || void 0).concat(origIdx.slice(v3));
                if (v0 > v2) {
                    v0 -= 1;
                }
                if (v1 > v2) {
                    v1 -= 1;
                }
                if (v3 > v2) {
                    v3 -= 1;
                }
                if (v4 > v2) {
                    v4 -= 1;
                }
                facelen--;
                head = v3;
                n--;
                broke = true;
            }
            v2 = (v2 + 1 + facelen) % facelen;
            if (y <= 0 || broke || v2 === head) {
                break;
            }
        }
    }
    return diagonals;
};

triEq = function(tri1, tri2) {
    return ((tri1[0] === tri2[0]) && (tri1[1] === tri2[1]) && (tri1[2] === tri2[2])) || ((tri1[0] === tri2[1]) && (tri1[1] === tri2[2]) && (tri1[2] === tri2[0])) || ((tri1[0] === tri2[2]) && (tri1[1] === tri2[0]) && (tri1[2] === tri2[1]));
};

diagsToTris = function(f, diags) {
    var already_present, d, e1, e2, edges, extant_tri, k, l, len, len1, len2, len3, len4, len5, len6, len7, len8, m, o, p, q, r, redges, ref, ref1, ref2, ref3, ref4, ref5, ref6, results, s, t, tri, tris, u, uniques, v1, v2;
    edges = [];
    redges = [];
    ref1 = (function() {
        results = [];
        for (var l = 0, ref = f.length; 0 <= ref ? l < ref : l > ref; 0 <= ref ? l++ : l--){ results.push(l); }
        return results;
    }).apply(this).map(function(i) {
        return [i, (i + 1) % f.length];
    });
    for (k = 0, len = ref1.length; k < len; k++) {
        ref2 = ref1[k], v1 = ref2[0], v2 = ref2[1];
        edges[v1] = [v2];
        redges[v2] = [v1];
    }
    for (m = 0, len1 = diags.length; m < len1; m++) {
        d = diags[m];
        edges[d[0]].push(d[1]);
        edges[d[1]].push(d[0]);
        redges[d[0]].push(d[1]);
        redges[d[1]].push(d[0]);
    }
    tris = [];
    for (o = 0, len2 = diags.length; o < len2; o++) {
        d = diags[o];
        ref3 = edges[d[1]];
        for (p = 0, len3 = ref3.length; p < len3; p++) {
            e1 = ref3[p];
            ref4 = redges[d[0]];
            for (q = 0, len4 = ref4.length; q < len4; q++) {
                e2 = ref4[q];
                if (e1 === e2) {
                    tris.push([d[0], d[1], e1]);
                }
            }
        }
        ref5 = edges[d[0]];
        for (r = 0, len5 = ref5.length; r < len5; r++) {
            e1 = ref5[r];
            ref6 = redges[d[1]];
            for (s = 0, len6 = ref6.length; s < len6; s++) {
                e2 = ref6[s];
                if (e1 === e2) {
                    tris.push([d[1], d[0], e1]);
                }
            }
        }
    }
    uniques = [tris.pop()];
    for (t = 0, len7 = tris.length; t < len7; t++) {
        tri = tris[t];
        already_present = false;
        for (u = 0, len8 = uniques.length; u < len8; u++) {
            extant_tri = uniques[u];
            if (triEq(tri, extant_tri)) {
                already_present = true;
                break;
            }
        }
        if (!already_present) {
            uniques.push(tri);
        }
    }
    return uniques;
};

triangulate = function(poly, colors) {
    var TwoDface, diags, f, k, l, newpoly, ref, ref1, ref2, ref3, tri, tris;
    klog("triangulate " + poly.name);
    newpoly = new Polyhedron(poly.name);
    newpoly.vertices = clone(poly.vertices);
    newpoly.face_classes = [];
    for (k = ref = i, ref1 = poly.faces.length; ref <= ref1 ? k < ref1 : k > ref1; ref <= ref1 ? k++ : k--) {
        f = poly.faces[i];
        if (f.length > 3) {
            TwoDface = project2dface(f.map(function(v) {
                return poly.vertices[v];
            }));
            diags = getDiagonals(TwoDface);
            tris = diagsToTris(f, diags);
            for (l = ref2 = j, ref3 = tris.length; ref2 <= ref3 ? l < ref3 : l > ref3; ref2 <= ref3 ? l++ : l--) {
                tri = tris[j];
                newpoly.faces.push([f[tri[0]], f[tri[1]], f[tri[2]]]);
                if (colors) {
                    newpoly.face_classes.push(poly.face_classes[i]);
                }
            }
        } else {
            newpoly.faces.push([f[0], f[1], f[2]]);
            if (colors) {
                newpoly.face_classes.push(poly.face_classes[i]);
            }
        }
    }
    return newpoly;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJpYW5ndWxhdGUuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFBQSxJQUFBOztBQXNCRSxhQUFlLE9BQUEsQ0FBUSxjQUFSOztBQUVqQixZQUFBLEdBQWUsU0FBQyxLQUFEO0FBRVgsUUFBQTtJQUFBLE9BQUEsR0FBVTtJQUNWLFNBQUEsR0FBWTtJQUNaLEdBQUEsR0FBTTtJQUNOLE9BQUEsR0FBVSxLQUFLLENBQUM7SUFFaEIsR0FBQSxHQUFNLFNBQUMsQ0FBRCxFQUFJLENBQUo7ZUFBVSxDQUFDLENBQUEsSUFBSyxDQUFOLENBQUEsSUFBYSxDQUFDLENBQUMsQ0FBQSxJQUFNLENBQVA7SUFBeEI7SUFDTixLQUFBLEdBQVEsU0FBQyxFQUFELEVBQUksRUFBSixFQUFPLEVBQVA7ZUFBZSxDQUFDLENBQUMsRUFBRyxDQUFBLENBQUEsQ0FBSCxHQUFNLEVBQUcsQ0FBQSxDQUFBLENBQVYsQ0FBQSxHQUFjLENBQUMsRUFBRyxDQUFBLENBQUEsQ0FBSCxHQUFNLEVBQUcsQ0FBQSxDQUFBLENBQVYsQ0FBZixDQUFBLEdBQWdDLENBQUMsQ0FBQyxFQUFHLENBQUEsQ0FBQSxDQUFILEdBQU0sRUFBRyxDQUFBLENBQUEsQ0FBVixDQUFBLEdBQWMsQ0FBQyxFQUFHLENBQUEsQ0FBQSxDQUFILEdBQU0sRUFBRyxDQUFBLENBQUEsQ0FBVixDQUFmO0lBQS9DO0lBQ1IsSUFBQSxHQUFPLFNBQUMsRUFBRCxFQUFLLEVBQUwsRUFBUyxFQUFUO2VBQWdCLEtBQUEsQ0FBTSxFQUFOLEVBQVUsRUFBVixFQUFjLEVBQWQsQ0FBQSxHQUFvQjtJQUFwQztJQUNQLE1BQUEsR0FBUyxTQUFDLEVBQUQsRUFBSyxFQUFMLEVBQVMsRUFBVDtlQUFnQixLQUFBLENBQU0sRUFBTixFQUFVLEVBQVYsRUFBYyxFQUFkLENBQUEsSUFBcUI7SUFBckM7SUFDVCxTQUFBLEdBQVksU0FBQyxFQUFELEVBQUssRUFBTCxF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Q0FBQSxDQUE1QyxFQURKOztBQUhKLGFBSko7U0FBQSxNQUFBO1lBVUksT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFkLENBQW1CLENBQUMsQ0FBRSxDQUFBLENBQUEsQ0FBSCxFQUFPLENBQUUsQ0FBQSxDQUFBLENBQVQsRUFBYSxDQUFFLENBQUEsQ0FBQSxDQUFmLENBQW5CO1lBQ0EsSUFBRyxNQUFIO2dCQUNJLE9BQU8sQ0FBQyxZQUFZLENBQUMsSUFBckIsQ0FBMEIsSUFBSSxDQUFDLFlBQWEsQ0FBQSxDQUFBLENBQTVDLEVBREo7YUFYSjs7QUFGSjtXQWVBO0FBdkJVIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAwMDAgICAgIDAwMDAwMDAgICAgMDAwICAwMDAwMDAwMDAgIDAwMCAwIDAwMCAgMDAwICAwMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwMCAgICAgMDAwICAgICAwMDAwMDAwICAgXG4gICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgXG4jIyNcbiMgUG9seWjDqWRyb25pc21lXG4jPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiNcbiMgQSB0b3kgZm9yIGNvbnN0cnVjdGluZyBhbmQgbWFuaXB1bGF0aW5nIHBvbHloZWRyYSBhbmQgb3RoZXIgbWVzaGVzXG4jXG4jIENvcHlyaWdodCAyMDE5LCBBbnNlbG0gTGV2c2theWFcbiMgUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlXG4jXG5cbiMgRWFyLWJhc2VkIHRyaWFuZ3VsYXRpb24gb2YgMmQgZmFjZXMsIHRha2VzIGFycmF5IG9mIDJkIGNvb3JkcyBpbiB0aGUgZmFjZSBvcmRlcmluZ1xuIyBSZXR1cm5zIGluZGljZXMgb2YgdGhlIG5ldyBkaWFnb25hbCBsaW5lcyB0byBjdXQuXG4jXG4jIGFzc3VtZXMgcGxhbmFyaXR5IG9mIGNvdXJzZSwgc28gdGhpcyBpc24ndCB0aGUgaWRlYWwgYWxnbyBmb3IgbWFraW5nIGFlc3RoZXRpY2FsbHkgcGxlYXNpbmdcbiMgXCJmbGF0dGVuaW5nXCIgY2hvaWNlcyBpbiBkaXN0b3J0ZWQgcG9seWhlZHJhbCBwbGFuZXMuXG5cbnsgUG9seWhlZHJvbiB9ID0gcmVxdWlyZSAnLi9wb2x5aGVkcm9uJ1xuXG5nZXREaWFnb25hbHMgPSAodmVydHMpIC0+XG5cbiAgICBsaW1pdGVyID0gOTk5XG4gICAgZGlhZ29uYWxzID0gW11cbiAgICBlYXIgPSBbXVxuICAgIGZhY2VsZW4gPSB2ZXJ0cy5sZW5ndGhcbiAgXG4gICAgWE9SID0gKHgsIHkpIC0+ICh4IG9yIHkpIGFuZCAhKHggYW5kIHkpO1xuICAgIEFyZWEyID0gKFZhLFZiLFZjKSAgLT4gKChWYlswXS1WYVswXSkqKFZjWzFdLVZhWzFdKSkgLSAoKFZjWzBdLVZhWzBdKSooVmJbMV0tVmFbMV0pKTtcbiAgICBMZWZ0ID0gKFZhLCBWYiwgVmMpIC0+IEFyZWEyKFZhLCBWYiwgVmMpID4gMDtcbiAgICBMZWZ0T24gPSAoVmEsIFZiLCBWYykgLT4gQXJlYTIoVmEsIFZiLCBWYykgPj0gMDtcbiAgICBDb2xsaW5lYXIgPSAoVmEsIFZiLCBWYykgLT4gQXJlYTIoVmEsIFZiLCBWYykgPT0gMDtcbiAgXG4gICAgQmV0d2VlbiA9IChWYSwgVmIsIFZjKSAtPlxuICAgICAgICBpZiBDb2xsaW5lYXIgVmEsIFZiLCBWYyAgXG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgaWYgVmFbMF0gIT0gVmJbMF0gXG4gICAgICAgICAgICByZXR1cm4gKChWYVswXSA8PSBWY1swXSkgYW5kIChWY1swXSA8PSBWYlswXSkpIG9yICgoVmFbMF0gPj0gVmNbMF0pIGFuZCAoVmNbMF0gPj0gVmJbMF0pKVxuICAgICAgICBlbHNlIFxuICAgICAgICAgICAgcmV0dXJuICgoVmFbMV0gPD0gVmNbMV0pIGFuZCAoVmNbMV0gPD0gVmJbMV0pKSBvciAoKFZhWzFdID49IFZjWzFdKSBhbmQgKFZjWzFdID49IFZiWzFdKSlcbiAgXG4gICAgSW50ZXJzZWN0UHJvcCA9IChWYSwgVmIsIFZjLCBWZCkgLT5cbiAgICAgICAgaWYgQ29sbGluZWFyKFZhLCBWYiwgVmMpIG9yIENvbGxpbmVhcihWYSwgVmIsIFZkKSBvciBDb2xsaW5lYXIoVmMsIFZkLCBWYSkgb3IgQ29sbGluZWFyKFZjLCBWZCwgVmIpIFxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgWE9SKExlZnQoVmEsIFZiLCBWYyksIExlZnQoVmEsIFZiLCBWZCkpIGFuZCBYT1IoTGVmdChWYywgVmQsIFZhKSwgTGVmdChWYywgVmQsIFZiKSlcbiAgXG4gICAgSW50ZXJzZWN0ID0gKFZhLCBWYiwgVmMsIFZkKSAtPlxuICAgICAgICBpZiBJbnRlcnNlY3RQcm9wIFZhLCBWYiwgVmMsIFZkXG4gICAgICAgICAgICB0cnVlXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEJldHdlZW4oVmEsIFZiLCBWYykgb3IgQmV0d2VlbihWYSwgVmIsIFZkKSBvciBCZXR3ZWVuKFZjLCBWZCwgVmEpIG9yIEJldHdlZW4oVmMsIFZkLCBWYilcbiAgXG4gICAgSW5Db25lID0gKGEsIGIpIC0+XG4gICAgICAgIGExID0gKGErMStmYWNlbGVuKSVmYWNlbGVuXG4gICAgICAgIGEwID0gKChhLTEpK2ZhY2VsZW4pJWZhY2VsZW5cbiAgICAgICAgaWYgTGVmdE9uIHZlcnRzW2FdLCB2ZXJ0c1thMV0sIHZlcnRzW2EwXVxuICAgICAgICAgICAgcmV0dXJuIExlZnQodmVydHNbYV0sIHZlcnRzW2JdLCB2ZXJ0c1thMF0pIGFuZCBMZWZ0KHZlcnRzW2JdLCB2ZXJ0c1thXSwgdmVydHNbYTFdKVxuICAgICAgICBub3QgKExlZnRPbih2ZXJ0c1thXSwgdmVydHNbYl0sIHZlcnRzW2ExXSkgYW5kIExlZnRPbih2ZXJ0c1tiXSwgdmVydHNbYV0sIHZlcnRzW2EwXSkpXG4gIFxuICAgIERpYWdvbmFsaWUgPSAoYSwgYikgLT5cbiAgICAgICAgYyA9IDBcbiAgICAgICAgd2hpbGUgdHJ1ZVxuICAgICAgICAgICAgYzEgPSAoYysxK2ZhY2VsZW4pJWZhY2VsZW5cbiAgICAgICAgICAgIGlmICgoYyAhPSBhKSBhbmQgKGMxICE9IGEpIGFuZCAoYyAhPSBiKSBhbmQgKGMxICE9IGIpIGFuZCBJbnRlcnNlY3RQcm9wKHZlcnRzW2FdLCB2ZXJ0c1tiXSwgdmVydHNbY10sIHZlcnRzW2MxXSkpIFxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgYyAgPSAoYysxK2ZhY2VsZW4pJWZhY2VsZW5cbiAgICAgICAgICAgIGlmIGMgPT0gMFxuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIHJldHVybiB0cnVlXG4gIFxuICAgIERpYWdvbmFsID0gKGEsIGIpIC0+IEluQ29uZShhLCBiKSBhbmQgSW5Db25lKGIsIGEpIGFuZCBEaWFnb25hbGllKGEsIGIpXG4gIFxuICAgIHYxID0gMFxuICAgIHdoaWxlIHRydWVcbiAgICAgICAgdjIgPSAodjErMStmYWNlbGVuKSVmYWNlbGVuICMgdjEubmV4dFxuICAgICAgICB2MCA9ICgodjEtMSkrZmFjZWxlbiklZmFjZWxlbiAjIHYxLnByZXZcbiAgICAgICAgZWFyW3YxXSA9IERpYWdvbmFsIHYwLCB2MlxuICAgICAgICB2MSA9ICh2MSsxK2ZhY2VsZW4pJWZhY2VsZW4gXG4gICAgICAgIGlmIHYxID09IDAgdGhlbiBicmVha1xuICBcbiAgICBvcmlnSWR4ID0gWzAuLi5mYWNlbGVuXVxuICAgIG4gPSBmYWNlbGVuICMgdmVydHMubGVuZ3RoXG4gICAgeiA9IGxpbWl0ZXIgXG4gICAgaGVhZCA9IDAgIz8/XG4gICAgd2hpbGUgKHogPiAwKSBhbmQgKG4gPiAzKVxuICAgICAgICB6IC09IDFcbiAgICAgICAgdjIgPSBoZWFkXG4gICAgICAgIHkgPSBsaW1pdGVyXG4gICAgICAgIHdoaWxlIHRydWVcbiAgICAgICAgICAgIHkgLT0gMTtcbiAgICAgICAgICAgIGJyb2tlID0gZmFsc2VcbiAgICAgICAgICAgIGlmIGVhclt2Ml1cbiAgICAgICAgICAgICAgICB2MyA9ICh2MisxK2ZhY2VsZW4pJWZhY2VsZW4gIyB2Mi5uZXh0XG4gICAgICAgICAgICAgICAgdjQgPSAodjMrMStmYWNlbGVuKSVmYWNlbGVuICMgdjMubmV4dFxuICAgICAgICAgICAgICAgIHYxID0gKCh2Mi0xKStmYWNlbGVuKSVmYWNlbGVuICMgdjIucHJldlxuICAgICAgICAgICAgICAgIHYwID0gKCh2MS0xKStmYWNlbGVuKSVmYWNlbGVuICMgdjEucHJldlxuICAgICAgICAgICAgICAgIGRpYWdvbmFscy5wdXNoKFsgb3JpZ0lkeFt2MV0sIG9yaWdJZHhbdjNdIF0pIFxuICAgICAgICAgICAgICAgIGVhclt2MV0gPSBEaWFnb25hbCh2MCwgdjMpIFxuICAgICAgICAgICAgICAgIGVhclt2M10gPSBEaWFnb25hbCh2MSwgdjQpIFxuICAgICAgICAgICAgICAgICN2MS5uZXh0ID0gdjNcbiAgICAgICAgICAgICAgICAjdjMucHJldiA9IHYxXG4gICAgICAgICAgICAgICAgdmVydHMgPSB2ZXJ0cy5zbGljZSgwLCArdjIgKyAxIG9yIHVuZGVmaW5lZCkuY29uY2F0KHZlcnRzLnNsaWNlKHYzKSlcbiAgICAgICAgICAgICAgICBvcmlnSWR4ID0gb3JpZ0lkeC5zbGljZSgwLCArdjIgKyAxIG9yIHVuZGVmaW5lZCkuY29uY2F0KG9yaWdJZHguc2xpY2UodjMpKVxuICAgICAgICAgICAgICAgIGlmICh2MD52MikgdGhlbiB2MCAtPSAxXG4gICAgICAgICAgICAgICAgaWYgKHYxPnYyKSB0aGVuIHYxIC09IDFcbiAgICAgICAgICAgICAgICBpZiAodjM+djIpIHRoZW4gdjMgLT0gMVxuICAgICAgICAgICAgICAgIGlmICh2ND52MikgdGhlbiB2NCAtPSAxXG4gICAgICAgICAgICAgICAgZmFjZWxlbi0tXG4gICAgICAgICAgICAgICAgaGVhZCA9IHYzXG4gICAgICAgICAgICAgICAgbi0tXG4gICAgICAgICAgICAgICAgYnJva2UgPSB0cnVlXG4gICAgICAgICAgICB2MiA9ICh2MisxK2ZhY2VsZW4pJWZhY2VsZW4gIyB2Mi5uZXh0XG4gICAgICAgICAgICBpZiB5IDw9IDAgb3IgYnJva2Ugb3IgdjIgPT0gaGVhZCBcbiAgICAgICAgICAgICAgICBicmVha1xuICBcbiAgICByZXR1cm4gZGlhZ29uYWxzXG5cbiMgZXF1YXRlcyB0cmlwbGV0cyBvZiBudW1iZXJzIGlmIHRoZXkgY2FuIGJlIHJvdGF0ZWQgaW50byBpZGVudGl0eVxudHJpRXEgPSAodHJpMSwgdHJpMikgLT4gKCgodHJpMVswXSA9PSB0cmkyWzBdKSBhbmQgKHRyaTFbMV0gPT0gdHJpMlsxXSkgYW5kICh0cmkxWzJdID09IHRyaTJbMl0pKSBvciAoKHRyaTFbMF0gPT0gdHJpMlsxXSkgYW5kICh0cmkxWzFdID09IHRyaTJbMl0pIGFuZCAodHJpMVsyXSA9PSB0cmkyWzBdKSkgIG9yICgodHJpMVswXSA9PSB0cmkyWzJdKSBhbmQgKHRyaTFbMV0gPT0gdHJpMlswXSkgYW5kICh0cmkxWzJdID09IHRyaTJbMV0pKSkgXG5cbiMgZ29kLWF3ZnVsIGJ1dCB3b3JraW5nIGhhY2sgdG8gdHVybiBkaWFnb25hbHMgaW50byB0cmlhbmdsZXNcbiMgc3dpdGNoIHRvIGFuIGVkZ2UtbWF0Y2hpbmcgYWxnbywgaXQgd291bGQgYmUgMTB4IHNpbXBsZXJcbmRpYWdzVG9UcmlzID0gKGYsZGlhZ3MpIC0+XG4gICAgZWRnZXMgPSBbXVxuICAgIHJlZGdlcyA9IFtdXG4gICAgIyBnZXQgZWRnZXMgZnJvbSBmYWNlcyBhcyBhc3NvYyBhcnJheXNcbiAgICBmb3IgW3YxLCB2Ml0gaW4gKFswLi4uZi5sZW5ndGhdLm1hcCAoaSkgLT4gW2ksIChpKzEpJWYubGVuZ3RoXSlcbiAgICAgICAgZWRnZXNbdjFdICA9IFt2Ml1cbiAgICAgICAgcmVkZ2VzW3YyXSA9IFt2MV1cbiAgICBmb3IgZCBpbiBkaWFncyAgIyBwdXNoIHRoZSBkaWFnb25hbHMgaW50byB0aGUgYXNzb2MgYXJyYXlzIGluIGJvdGggZGlyZWN0aW9ucyFcbiAgICAgICAgZWRnZXNbZFswXV0ucHVzaCBkWzFdXG4gICAgICAgIGVkZ2VzW2RbMV1dLnB1c2ggZFswXVxuICAgICAgICByZWRnZXNbZFswXV0ucHVzaCBkWzFdXG4gICAgICAgIHJlZGdlc1tkWzFdXS5wdXNoIGRbMF1cbiAgICB0cmlzPVtdXG4gICAgZm9yIGQgaW4gZGlhZ3MgIyBvcmlnIE4tZmFjZSwgTi0yIHRyaWFuZ2xlcyBmcm9tIHRoZSBOLTMgZGlhZ29uYWxzXG4gICAgICAgIGZvciBlMSBpbiBlZGdlc1tkWzFdXSAjIGVkZ2UgYWZ0ZXIgZGlhZ1xuICAgICAgICAgICAgZm9yIGUyIGluIHJlZGdlc1tkWzBdXSAjIGVkZ2UgYmVmb3JlIGRpYWdcbiAgICAgICAgICAgICAgICBpZiBlMSA9PSBlMiAjIGlmIHRoZXkgbWVldCB3ZSBoYXZlIGEgdHJpYW5nbGUhXG4gICAgICAgICAgICAgICAgICAgIHRyaXMucHVzaCBbZFswXSxkWzFdLGUxXVxuICAgICAgICBmb3IgZTEgaW4gZWRnZXNbZFswXV0gIyBzYW1lIGFzIGFib3ZlIGZvciBvdGhlciBkaXIgYWxvbmcgZGlhZ29uYWxcbiAgICAgICAgICAgIGZvciBlMiBpbiByZWRnZXNbZFsxXV1cbiAgICAgICAgICAgICAgICBpZiBlMSA9PSBlMlxuICAgICAgICAgICAgICAgICAgICB0cmlzLnB1c2ggW2RbMV0sZFswXSxlMV1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgIyB1bmZvcnR1bmF0ZWx5IHRoZSBhYm92ZSBkdXBsaWNhdGVzIHRyaWFuZ2xlcywgc28gZmlsdGVyIG91dCByZXBlYXRzXG4gICAgdW5pcXVlcyA9IFt0cmlzLnBvcCgpXVxuICAgIGZvciB0cmkgaW4gdHJpc1xuICAgICAgICBhbHJlYWR5X3ByZXNlbnQgPSBmYWxzZVxuICAgICAgICBmb3IgZXh0YW50X3RyaSBpbiB1bmlxdWVzXG4gICAgICAgICAgICBpZiB0cmlFcSB0cmksIGV4dGFudF90cmlcbiAgICAgICAgICAgICAgICBhbHJlYWR5X3ByZXNlbnQgPSB0cnVlXG4gICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgaWYgbm90IGFscmVhZHlfcHJlc2VudCBcbiAgICAgICAgICAgIHVuaXF1ZXMucHVzaCB0cmlcbiAgXG4gICAgcmV0dXJuIHVuaXF1ZXNcblxuIyBkcml2ZXIgcm91dGluZSwgcHJvamVjdHMgM2QgZmFjZSB0byAyZCwgZ2V0IGRpYWdvbmFscyB0aGVuIHRyaWFuZ2xlcyxcbiMgdGhlbiBidWlsZHMgbmV3IHBvbHloZWRyb24gb3V0IG9mIHRoZW0sIHByZXNlcnZpbmcgb3JpZ2luYWwgZmFjZSBjb2xvcnNcbnRyaWFuZ3VsYXRlID0gKHBvbHksIGNvbG9ycykgLT5cblxuICAgIGtsb2cgXCJ0cmlhbmd1bGF0ZSAje3BvbHkubmFtZX1cIlxuICBcbiAgICBuZXdwb2x5ID0gbmV3IFBvbHloZWRyb24gcG9seS5uYW1lICMgZG9uJ3QgY2hhbmdlIHRoZSBuYW1lXG4gICAgbmV3cG9seS52ZXJ0aWNlcyA9IGNsb25lIHBvbHkudmVydGljZXNcbiAgICBuZXdwb2x5LmZhY2VfY2xhc3NlcyA9IFtdXG5cbiAgICBmb3IgW2kuLi5wb2x5LmZhY2VzLmxlbmd0aF0gXG4gICAgICAgIGYgPSBwb2x5LmZhY2VzW2ldXG4gICAgICAgIGlmIGYubGVuZ3RoID4gM1xuICAgICAgICAgICAgVHdvRGZhY2UgPSBwcm9qZWN0MmRmYWNlIGYubWFwICh2KSAtPiBwb2x5LnZlcnRpY2VzW3ZdXG4gICAgICAgICAgICBkaWFncyA9IGdldERpYWdvbmFscyBUd29EZmFjZVxuICAgICAgICAgICAgdHJpcyAgPSBkaWFnc1RvVHJpcyBmLGRpYWdzXG4gICAgICAgICAgICBmb3IgW2ouLi50cmlzLmxlbmd0aF1cbiAgICAgICAgICAgICAgICB0cmkgPSB0cmlzW2pdXG4gICAgICAgICAgICAgICAgbmV3cG9seS5mYWNlcy5wdXNoIFsgZlt0cmlbMF1dLCBmW3RyaVsxXV0sIGZbdHJpWzJdXSBdXG4gICAgICAgICAgICAgICAgaWYgY29sb3JzICBcbiAgICAgICAgICAgICAgICAgICAgbmV3cG9seS5mYWNlX2NsYXNzZXMucHVzaCBwb2x5LmZhY2VfY2xhc3Nlc1tpXVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBuZXdwb2x5LmZhY2VzLnB1c2ggW2ZbMF0sIGZbMV0sIGZbMl1dXG4gICAgICAgICAgICBpZiBjb2xvcnNcbiAgICAgICAgICAgICAgICBuZXdwb2x5LmZhY2VfY2xhc3Nlcy5wdXNoIHBvbHkuZmFjZV9jbGFzc2VzW2ldXG4gICAgbmV3cG9seVxuIl19
//# sourceURL=../../coffee/poly/triangulate.coffee