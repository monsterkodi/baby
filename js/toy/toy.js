// koffee 1.7.0

/*
000000000   0000000   000   000  
   000     000   000   000 000   
   000     000   000    00000    
   000     000   000     000     
   000      0000000      000
 */
var Toy,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

Toy = (function() {
    Toy.instance = null;

    function Toy(mCanvas) {
        var devicePixelRatio;
        this.mCanvas = mCanvas;
        this.resize = bind(this.resize, this);
        this.renderLoop = bind(this.renderLoop, this);
        this.mCreated = false;
        this.mGLContext = null;
        this.mEffect = null;
        this.mTo = null;
        this.mIsPaused = false;
        this.mForceFrame = false;
        this.mPass = [];
        this.mActiveDoc = 0;
        devicePixelRatio = window.devicePixelRatio || 1;
        this.mCanvas.tabIndex = '0';
        this.mCanvas.width = this.mCanvas.offsetWidth * devicePixelRatio;
        this.mCanvas.height = this.mCanvas.offsetHeight * devicePixelRatio;
        this.mTo = performance.now();
        this.mTf = 0;
        this.mRestarted = true;
        this.mMouseOriX = 0;
        this.mMouseOriY = 0;
        this.mMousePosX = 0;
        this.mMousePosY = 0;
        this.mIsRendering = false;
        this.mGLContext = Renderer.createGlContext(this.mCanvas);
        if (!this.mGLContext) {
            console.log('no gl context');
        }
        this.mErrors = new Array();
        this.mEffect = new Effect(this.mGLContext, this.mCanvas.width, this.mCanvas.height);
        if (!this.mEffect.mCreated) {
            console.log('no effect');
            return;
        }
        this.mCanvas.addEventListener('webglcontextlost', function(event) {
            console.log('webglcontextlost');
            return event.preventDefault();
        });
        this.loadNew();
    }

    Toy.prototype.startRendering = function() {
        this.mIsRendering = true;
        return this.renderLoop();
    };

    Toy.prototype.renderLoop = function() {
        var dtime, ltime, time;
        if (!this.mGLContext) {
            return;
        }
        requestAnimationFrame(this.renderLoop);
        if (this.mIsPaused && !this.mForceFrame) {
            return;
        }
        this.mForceFrame = false;
        time = performance.now();
        ltime = 0.0;
        dtime = 0.0;
        if (this.mIsPaused) {
            ltime = this.mTf;
            dtime = 1000.0 / 60.0;
        } else {
            ltime = time - this.mTo;
            if (this.mRestarted) {
                dtime = 1000.0 / 60.0;
            } else {
                dtime = ltime - this.mTf;
            }
            this.mTf = ltime;
        }
        this.mRestarted = false;
        return this.mEffect.paint(ltime / 1000.0, dtime / 1000.0, 60, this.mMouseOriX, this.mMouseOriY, this.mMousePosX, this.mMousePosY, this.mIsPaused);
    };

    Toy.prototype.resize = function(xres, yres) {
        if (this.mCanvas) {
            this.mCanvas.width = this.mCanvas.offsetWidth;
            this.mCanvas.height = this.mCanvas.offsetHeight;
            this.mEffect.setSize(this.mCanvas.width, this.mCanvas.height);
            return this.mForceFrame = true;
        }
    };

    Toy.prototype.logErrors = function(result) {
        if (result) {
            return console.log(result);
        }
    };

    Toy.prototype.setTexture = function(slot, url) {
        var res;
        res = this.mEffect.newTexture(this.mActiveDoc, slot, url);
        if (!res.mFailed) {
            return this.mPass[this.mActiveDoc].mDirty = res.mNeedsShaderCompile;
        }
    };

    Toy.prototype.getTexture = function(slot) {
        return this.mEffect.getTexture(this.mActiveDoc, slot);
    };

    Toy.prototype.setShaderFromEditor = function(forceall) {
        var anyErrors, i, j, k, l, m, num, recompileAll, ref, ref1, result, shaderCode;
        anyErrors = false;
        num = this.mEffect.getNumPasses();
        recompileAll = false;
        for (i = k = 0, ref = num; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
            if (this.mEffect.getPassType(i) === 'common' && (this.mPass[i].mDirty || forceall)) {
                recompileAll = true;
                break;
            }
        }
        for (j = l = 0; l < 4; j = ++l) {
            for (i = m = 0, ref1 = num; 0 <= ref1 ? m < ref1 : m > ref1; i = 0 <= ref1 ? ++m : --m) {
                if (j === 0 && this.mEffect.getPassType(i) !== 'common') {
                    continue;
                }
                if (j === 1 && this.mEffect.getPassType(i) !== 'buffer') {
                    continue;
                }
                if (j === 2 && this.mEffect.getPassType(i) !== 'cubemap') {
                    continue;
                }
                if (j === 3 && this.mEffect.getPassType(i) !== 'image') {
                    continue;
                }
                if (recompileAll || this.mPass[i].mDirty || forceall) {
                    shaderCode = this.mPass[i].mCode;
                    result = this.mEffect.newShader(shaderCode, i);
                    if (result) {
                        anyErrors = true;
                    }
                    this.mPass[i].mError = result;
                    this.mPass[i].mDirty = false;
                }
            }
        }
        this.logErrors(this.mPass[this.mActiveDoc].mError);
        if (!anyErrors) {
            if (!this.mIsRendering) {
                gToy.startRendering();
            }
            return this.mForceFrame = true;
        }
    };

    Toy.prototype.loadNew = function() {
        var i, k, passes, ref, res;
        passes = [
            {
                inputs: [],
                outputs: [
                    {
                        channel: 0,
                        id: "4dfGRr"
                    }
                ],
                type: 'image',
                code: "void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n    vec3 col = 0.15 + 0.15*cos(0.1*iTime+uv.xyx+vec3(0,2,4));\n    fragColor = vec4(col,1.0);\n}"
            }
        ];
        res = this.mEffect.newScriptJSON(passes);
        this.mPass = [];
        for (i = k = 0, ref = res.length; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
            this.mPass[i] = {
                mCode: res[i].mShader,
                mFailed: res[i].mFailed,
                mError: res[i].mError,
                mDirty: false
            };
        }
        this.logErrors(this.mPass[0].mError);
        return this.startRendering();
    };

    Toy.resize = function() {
        return Toy.instance.resize();
    };

    Toy.init = function() {
        return Toy.instance = new Toy(document.getElementById('glCanvas'));
    };

    return Toy;

})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG95LmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSxHQUFBO0lBQUE7O0FBUU07SUFFRixHQUFDLENBQUEsUUFBRCxHQUFZOztJQUVULGFBQUMsT0FBRDtBQUVDLFlBQUE7UUFGQSxJQUFDLENBQUEsVUFBRDs7O1FBRUEsSUFBQyxDQUFBLFFBQUQsR0FBZTtRQUNmLElBQUMsQ0FBQSxVQUFELEdBQWU7UUFDZixJQUFDLENBQUEsT0FBRCxHQUFlO1FBQ2YsSUFBQyxDQUFBLEdBQUQsR0FBZTtRQUNmLElBQUMsQ0FBQSxTQUFELEdBQWU7UUFDZixJQUFDLENBQUEsV0FBRCxHQUFlO1FBQ2YsSUFBQyxDQUFBLEtBQUQsR0FBZTtRQUNmLElBQUMsQ0FBQSxVQUFELEdBQWU7UUFFZixnQkFBQSxHQUFtQixNQUFNLENBQUMsZ0JBQVAsSUFBMkI7UUFFOUMsSUFBQyxDQUFBLE9BQU8sQ0FBQyxRQUFULEdBQW9CO1FBQ3BCLElBQUMsQ0FBQSxPQUFPLENBQUMsS0FBVCxHQUFrQixJQUFDLENBQUEsT0FBTyxDQUFDLFdBQVQsR0FBdUI7UUFDekMsSUFBQyxDQUFBLE9BQU8sQ0FBQyxNQUFULEdBQWtCLElBQUMsQ0FBQSxPQUFPLENBQUMsWUFBVCxHQUF3QjtRQUUxQyxJQUFDLENBQUEsR0FBRCxHQUFjLFdBQVcsQ0FBQyxHQUFaLENBQUE7UUFDZCxJQUFDLENBQUEsR0FBRCxHQUFjO1FBQ2QsSUFBQyxDQUFBLFVBQUQsR0FBYztRQUNkLElBQUMsQ0FBQSxVQUFELEdBQWM7UUFDZCxJQUFDLENBQUEsVUFBRCxHQUFjO1FBQ2QsSUFBQyxDQUFBLFVBQUQsR0FBYztRQUNkLElBQUMsQ0FBQSxVQUFELEdBQWM7UUFDZCxJQUFDLENBQUEsWUFBRCxHQUFnQjtRQUVoQixJQUFDLENBQUEsVUFBRCxHQUFjLFFBQVEsQ0FBQyxlQUFULENBQXlCLElBQUMsQ0FBQSxPQUExQjtRQUVkLElB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QUFTLG1GQUFUO1lBQ0ksSUFBQyxDQUFBLEtBQU0sQ0FBQSxDQUFBLENBQVAsR0FDSTtnQkFBQSxLQUFBLEVBQVMsR0FBSSxDQUFBLENBQUEsQ0FBRSxDQUFDLE9BQWhCO2dCQUNBLE9BQUEsRUFBUyxHQUFJLENBQUEsQ0FBQSxDQUFFLENBQUMsT0FEaEI7Z0JBRUEsTUFBQSxFQUFTLEdBQUksQ0FBQSxDQUFBLENBQUUsQ0FBQyxNQUZoQjtnQkFHQSxNQUFBLEVBQVMsS0FIVDs7QUFGUjtRQU9BLElBQUMsQ0FBQSxTQUFELENBQVcsSUFBQyxDQUFBLEtBQU0sQ0FBQSxDQUFBLENBQUUsQ0FBQyxNQUFyQjtlQUNBLElBQUMsQ0FBQSxjQUFELENBQUE7SUEzQks7O0lBNkJULEdBQUMsQ0FBQSxNQUFELEdBQVMsU0FBQTtlQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBYixDQUFBO0lBQUg7O0lBQ1QsR0FBQyxDQUFBLElBQUQsR0FBUyxTQUFBO2VBQUcsR0FBRyxDQUFDLFFBQUosR0FBZSxJQUFJLEdBQUosQ0FBUSxRQUFRLENBQUMsY0FBVCxDQUF3QixVQUF4QixDQUFSO0lBQWxCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICBcbiAgIDAwMCAgICAgMDAwICAgMDAwICAgMDAwIDAwMCAgIFxuICAgMDAwICAgICAwMDAgICAwMDAgICAgMDAwMDAgICAgXG4gICAwMDAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICBcbiAgIDAwMCAgICAgIDAwMDAwMDAgICAgICAwMDAgICAgIFxuIyMjXG5cbmNsYXNzIFRveVxuXG4gICAgQGluc3RhbmNlID0gbnVsbFxuICAgIFxuICAgIEA6IChAbUNhbnZhcykgLT5cblxuICAgICAgICBAbUNyZWF0ZWQgICAgPSBmYWxzZVxuICAgICAgICBAbUdMQ29udGV4dCAgPSBudWxsXG4gICAgICAgIEBtRWZmZWN0ICAgICA9IG51bGxcbiAgICAgICAgQG1UbyAgICAgICAgID0gbnVsbFxuICAgICAgICBAbUlzUGF1c2VkICAgPSBmYWxzZVxuICAgICAgICBAbUZvcmNlRnJhbWUgPSBmYWxzZVxuICAgICAgICBAbVBhc3MgICAgICAgPSBbXVxuICAgICAgICBAbUFjdGl2ZURvYyAgPSAwXG4gICAgXG4gICAgICAgIGRldmljZVBpeGVsUmF0aW8gPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyBvciAxXG4gICAgXG4gICAgICAgIEBtQ2FudmFzLnRhYkluZGV4ID0gJzAnXG4gICAgICAgIEBtQ2FudmFzLndpZHRoICA9IEBtQ2FudmFzLm9mZnNldFdpZHRoICogZGV2aWNlUGl4ZWxSYXRpb1xuICAgICAgICBAbUNhbnZhcy5oZWlnaHQgPSBAbUNhbnZhcy5vZmZzZXRIZWlnaHQgKiBkZXZpY2VQaXhlbFJhdGlvXG4gICAgXG4gICAgICAgIEBtVG8gICAgICAgID0gcGVyZm9ybWFuY2Uubm93KClcbiAgICAgICAgQG1UZiAgICAgICAgPSAwXG4gICAgICAgIEBtUmVzdGFydGVkID0gdHJ1ZVxuICAgICAgICBAbU1vdXNlT3JpWCA9IDBcbiAgICAgICAgQG1Nb3VzZU9yaVkgPSAwXG4gICAgICAgIEBtTW91c2VQb3NYID0gMFxuICAgICAgICBAbU1vdXNlUG9zWSA9IDBcbiAgICAgICAgQG1Jc1JlbmRlcmluZyA9IGZhbHNlXG4gICAgXG4gICAgICAgIEBtR0xDb250ZXh0ID0gUmVuZGVyZXIuY3JlYXRlR2xDb250ZXh0IEBtQ2FudmFzXG4gICAgICAgIFxuICAgICAgICBpZiBub3QgQG1HTENvbnRleHRcbiAgICAgICAgICAgIGxvZyAnbm8gZ2wgY29udGV4dCdcbiAgICBcbiAgICAgICAgQG1FcnJvcnMgPSBuZXcgQXJyYXkoKVxuICAgICAgICBcbiAgICAgICAgQG1FZmZlY3QgPSBuZXcgRWZmZWN0IEBtR0xDb250ZXh0LCBAbUNhbnZhcy53aWR0aCwgQG1DYW52YXMuaGVpZ2h0XG4gICAgICAgIGlmIG5vdCBAbUVmZmVjdC5tQ3JlYXRlZFxuICAgICAgICAgICAgbG9nICdubyBlZmZlY3QnXG4gICAgICAgICAgICByZXR1cm5cbiAgICBcbiAgICAgICAgQG1DYW52YXMuYWRkRXZlbnRMaXN0ZW5lciAnd2ViZ2xjb250ZXh0bG9zdCcgKGV2ZW50KSAtPlxuICAgICAgICAgICAgbG9nICd3ZWJnbGNvbnRleHRsb3N0J1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgICAgICBcbiAgICAgICAgQGxvYWROZXcoKVxuXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMDAgIDAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgIDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgc3RhcnRSZW5kZXJpbmc6IC0+XG5cbiAgICAgICAgQG1Jc1JlbmRlcmluZyA9IHRydWVcbiAgICAgICAgQHJlbmRlckxvb3AoKVxuICAgIFxuICAgIHJlbmRlckxvb3A6ID0+XG4gICAgICAgIFxuICAgICAgICBpZiBub3QgQG1HTENvbnRleHQgdGhlbiByZXR1cm5cblxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgQHJlbmRlckxvb3BcblxuICAgICAgICBpZiBAbUlzUGF1c2VkIGFuZCBub3QgQG1Gb3JjZUZyYW1lXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIFxuICAgICAgICBAbUZvcmNlRnJhbWUgPSBmYWxzZVxuXG4gICAgICAgIHRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKVxuXG4gICAgICAgIGx0aW1lID0gMC4wXG4gICAgICAgIGR0aW1lID0gMC4wXG4gICAgICAgIGlmIEBtSXNQYXVzZWRcbiAgICAgICAgICAgIGx0aW1lID0gQG1UZlxuICAgICAgICAgICAgZHRpbWUgPSAxMDAwLjAgLyA2MC4wXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGx0aW1lID0gdGltZSAtIEBtVG9cbiAgICAgICAgICAgIGlmIEBtUmVzdGFydGVkXG4gICAgICAgICAgICAgICAgZHRpbWUgPSAxMDAwLjAvNjAuMFxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGR0aW1lID0gbHRpbWUgLSBAbVRmIFxuICAgICAgICAgICAgQG1UZiA9IGx0aW1lXG4gICAgICAgIEBtUmVzdGFydGVkID0gZmFsc2VcblxuICAgICAgICBAbUVmZmVjdC5wYWludCBsdGltZS8xMDAwLjAsIGR0aW1lLzEwMDAuMCwgNjAsIEBtTW91c2VPcmlYLCBAbU1vdXNlT3JpWSwgQG1Nb3VzZVBvc1gsIEBtTW91c2VQb3NZLCBAbUlzUGF1c2VkIFxuXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgICAwMDAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgIDAwMCAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgXG4gICAgcmVzaXplOiAoeHJlcywgeXJlcykgPT5cblxuICAgICAgICBpZiBAbUNhbnZhc1xuICAgICAgICAgICAgQG1DYW52YXMud2lkdGggID0gQG1DYW52YXMub2Zmc2V0V2lkdGhcbiAgICAgICAgICAgIEBtQ2FudmFzLmhlaWdodCA9IEBtQ2FudmFzLm9mZnNldEhlaWdodFxuICAgICAgICAgICAgQG1FZmZlY3Quc2V0U2l6ZSBAbUNhbnZhcy53aWR0aCwgQG1DYW52YXMuaGVpZ2h0XG4gICAgICAgICAgICBAbUZvcmNlRnJhbWUgPSB0cnVlXG5cbiAgICBsb2dFcnJvcnM6IChyZXN1bHQpIC0+IGxvZyByZXN1bHQgaWYgcmVzdWx0XG5cbiAgICAjIDAwMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIFxuICAgICMgICAgMDAwICAgICAwMDAgICAgICAgIDAwMCAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAgICAwMDAgICAgIDAwMDAwMDAgICAgIDAwMDAwICAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDAgICBcbiAgICAjICAgIDAwMCAgICAgMDAwICAgICAgICAwMDAgMDAwICAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgICAgMDAwICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgXG4gICAgXG4gICAgc2V0VGV4dHVyZTogKHNsb3QsIHVybCkgLT5cblxuICAgICAgICByZXMgPSBAbUVmZmVjdC5uZXdUZXh0dXJlIEBtQWN0aXZlRG9jLCBzbG90LCB1cmxcbiAgICAgICAgaWYgbm90IHJlcy5tRmFpbGVkXG4gICAgICAgICAgICBAbVBhc3NbQG1BY3RpdmVEb2NdLm1EaXJ0eSA9IHJlcy5tTmVlZHNTaGFkZXJDb21waWxlXG5cbiAgICBnZXRUZXh0dXJlOiAoc2xvdCkgLT5cbiAgICAgICAgQG1FZmZlY3QuZ2V0VGV4dHVyZSggQG1BY3RpdmVEb2MsIHNsb3QgKVxuXG4gICAgc2V0U2hhZGVyRnJvbUVkaXRvcjogKGZvcmNlYWxsKSAtPlxuXG4gICAgICAgIGFueUVycm9ycyA9IGZhbHNlXG5cbiAgICAgICAgbnVtID0gQG1FZmZlY3QuZ2V0TnVtUGFzc2VzKClcblxuICAgICAgICByZWNvbXBpbGVBbGwgPSBmYWxzZVxuICAgICAgICBmb3IgaSBpbiBbMC4uLm51bV1cbiAgICAgICAgICAgIGlmIEBtRWZmZWN0LmdldFBhc3NUeXBlKGkpID09ICdjb21tb24nIGFuZCAoQG1QYXNzW2ldLm1EaXJ0eSBvciBmb3JjZWFsbClcbiAgICAgICAgICAgICAgICByZWNvbXBpbGVBbGwgPSB0cnVlXG4gICAgICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICBmb3IgaiBpbiBbMC4uLjRdXG4gICAgICAgICAgICBmb3IgaSBpbiBbMC4uLm51bV1cbiAgICAgICAgICAgICAgICBpZiBqID09IDAgYW5kIEBtRWZmZWN0LmdldFBhc3NUeXBlKGkpICE9ICdjb21tb24nICAgdGhlbiBjb250aW51ZVxuICAgICAgICAgICAgICAgIGlmIGogPT0gMSBhbmQgQG1FZmZlY3QuZ2V0UGFzc1R5cGUoaSkgIT0gJ2J1ZmZlcicgICB0aGVuIGNvbnRpbnVlXG4gICAgICAgICAgICAgICAgaWYgaiA9PSAyIGFuZCBAbUVmZmVjdC5nZXRQYXNzVHlwZShpKSAhPSAnY3ViZW1hcCcgIHRoZW4gY29udGludWVcbiAgICAgICAgICAgICAgICBpZiBqID09IDMgYW5kIEBtRWZmZWN0LmdldFBhc3NUeXBlKGkpICE9ICdpbWFnZScgICAgdGhlbiBjb250aW51ZVxuXG4gICAgICAgICAgICAgICAgaWYgcmVjb21waWxlQWxsIG9yIEBtUGFzc1tpXS5tRGlydHkgb3IgZm9yY2VhbGxcbiAgICAgICAgICAgICAgICAgICAgc2hhZGVyQ29kZSA9IEBtUGFzc1tpXS5tQ29kZVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBAbUVmZmVjdC5uZXdTaGFkZXIgc2hhZGVyQ29kZSwgaVxuICAgICAgICAgICAgICAgICAgICBpZiByZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgICAgIGFueUVycm9ycyA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgQG1QYXNzW2ldLm1FcnJvciA9IHJlc3VsdFxuICAgICAgICAgICAgICAgICAgICBAbVBhc3NbaV0ubURpcnR5ID0gZmFsc2VcblxuICAgICAgICBAbG9nRXJyb3JzIEBtUGFzc1tAbUFjdGl2ZURvY10ubUVycm9yXG5cbiAgICAgICAgaWYgbm90IGFueUVycm9yc1xuICAgICAgICAgICAgaWYgbm90IEBtSXNSZW5kZXJpbmdcbiAgICAgICAgICAgICAgICBnVG95LnN0YXJ0UmVuZGVyaW5nKClcbiAgICAgICAgICAgIEBtRm9yY2VGcmFtZSA9IHRydWVcblxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAwIDAwMCAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIFxuICAgICMgMDAwICAwMDAwICAwMDAgICAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwICAgICAwMCAgXG4gICAgXG4gICAgbG9hZE5ldzogLT5cbiAgICAgICAgcGFzc2VzID0gW3tcbiAgICAgICAgICAgIGlucHV0czogIFtdXG4gICAgICAgICAgICBvdXRwdXRzOiBbIHtjaGFubmVsOjAsIGlkOlwiNGRmR1JyXCIgfSBdXG4gICAgICAgICAgICB0eXBlOiAgICAnaW1hZ2UnXG4gICAgICAgICAgICBjb2RlOiBcIlwiXCJcbiAgICAgICAgICAgICAgICB2b2lkIG1haW5JbWFnZSggb3V0IHZlYzQgZnJhZ0NvbG9yLCBpbiB2ZWMyIGZyYWdDb29yZCApXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2ZWMyIHV2ID0gZnJhZ0Nvb3JkL2lSZXNvbHV0aW9uLnh5O1xuICAgICAgICAgICAgICAgICAgICB2ZWMzIGNvbCA9IDAuMTUgKyAwLjE1KmNvcygwLjEqaVRpbWUrdXYueHl4K3ZlYzMoMCwyLDQpKTtcbiAgICAgICAgICAgICAgICAgICAgZnJhZ0NvbG9yID0gdmVjNChjb2wsMS4wKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXCJcIlwiXG4gICAgICAgIH1dXG4gICAgICAgIFxuICAgICAgICByZXMgPSBAbUVmZmVjdC5uZXdTY3JpcHRKU09OIHBhc3Nlc1xuICAgICAgICBcbiAgICAgICAgQG1QYXNzID0gW11cbiAgICAgICAgXG4gICAgICAgIGZvciBpIGluIFswLi4ucmVzLmxlbmd0aF1cbiAgICAgICAgICAgIEBtUGFzc1tpXSA9IFxuICAgICAgICAgICAgICAgIG1Db2RlOiAgIHJlc1tpXS5tU2hhZGVyXG4gICAgICAgICAgICAgICAgbUZhaWxlZDogcmVzW2ldLm1GYWlsZWRcbiAgICAgICAgICAgICAgICBtRXJyb3I6ICByZXNbaV0ubUVycm9yXG4gICAgICAgICAgICAgICAgbURpcnR5OiAgZmFsc2VcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgQGxvZ0Vycm9ycyBAbVBhc3NbMF0ubUVycm9yXG4gICAgICAgIEBzdGFydFJlbmRlcmluZygpXG4gICAgICAgIFxuICAgIEByZXNpemU6IC0+IFRveS5pbnN0YW5jZS5yZXNpemUoKVxuICAgIEBpbml0OiAgIC0+IFRveS5pbnN0YW5jZSA9IG5ldyBUb3kgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQgJ2dsQ2FudmFzJ1xuIl19
//# sourceURL=../../coffee/toy/toy.coffee