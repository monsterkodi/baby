// koffee 1.6.0

/*
 0000000   0000000   00     00  00000000  00000000    0000000 
000       000   000  000   000  000       000   000  000   000
000       000000000  000000000  0000000   0000000    000000000
000       000   000  000 0 000  000       000   000  000   000
 0000000  000   000  000   000  00000000  000   000  000   000
 */
var Camera, PointLight, Quat, TargetCamera, UniversalCamera, Vect, animate, clamp, deg2rad, quat, reduce, ref, ref1, vec,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

ref = require('kxk'), deg2rad = ref.deg2rad, reduce = ref.reduce, clamp = ref.clamp;

ref1 = require('babylonjs'), TargetCamera = ref1.TargetCamera, UniversalCamera = ref1.UniversalCamera, PointLight = ref1.PointLight;

Vect = require('./vect');

Quat = require('./quat');

animate = require('./animate');

vec = function(x, y, z) {
    return new Vect(x, y, z);
};

quat = function(x, y, z, w) {
    return new Quat(x, y, z, w);
};

Camera = (function(superClass) {
    extend(Camera, superClass);

    function Camera(scene, view, canvas) {
        var height, width;
        this.scene = scene;
        this.view = view;
        this.canvas = canvas;
        this.setDist = bind(this.setDist, this);
        this.inertZoom = bind(this.inertZoom, this);
        this.onMouseWheel = bind(this.onMouseWheel, this);
        this.moveCenter = bind(this.moveCenter, this);
        this.fadeCenter = bind(this.fadeCenter, this);
        this.onMouseDrag = bind(this.onMouseDrag, this);
        this.onMouseUp = bind(this.onMouseUp, this);
        this.onMouseDown = bind(this.onMouseDown, this);
        this.del = bind(this.del, this);
        width = this.view.clientWidth;
        height = this.view.clientHeight;
        this.size = vec(width, height);
        this.dist = 10;
        this.maxDist = 100;
        this.minDist = 3;
        this.center = vec(0, 0, 0);
        this.moveFade = vec(0, 0, 0);
        this.degree = 90;
        this.rotate = 0;
        this.wheelInert = 0;
        this.pivotX = 0;
        this.pivotY = 0;
        this.moveX = 0;
        this.moveY = 0;
        this.moveZ = 0;
        this.quat = quat();
        Camera.__super__.constructor.call(this, 'Camera', vec(0, -10, 0), this.scene);
        this.rotationQuaternion = new Quat();
        this.setTarget(this.center);
        this.inertia = 0.8;
        this.light = new PointLight('spot', this.position, this.scene);
        this.light.intensity = 0.5;
        this.view.addEventListener('mousewheel', this.onMouseWheel);
        this.navigate();
    }

    Camera.prototype.getDir = function() {
        return this.rotationQuaternion.rotated(Vect.unitZ);
    };

    Camera.prototype.getUp = function() {
        return this.rotationQuaternion.rotated(Vect.unitY);
    };

    Camera.prototype.getRight = function() {
        return this.rotationQuaternion.rotated(Vect.unitX);
    };

    Camera.prototype.setCenter = function(p) {
        this.center = vec(p);
        return this.navigate();
    };

    Camera.prototype.del = function() {
        return this.view.removeEventListener('mousewheel', this.onMouseWheel);
    };

    Camera.prototype.onMouseDown = function(event) {
        this.downButtons = event.buttons;
        this.mouseMoved = false;
        this.mouseX = event.clientX;
        this.mouseY = event.clientY;
        return this.downPos = vec(this.mouseX, this.mouseY);
    };

    Camera.prototype.onMouseUp = function(event) {};

    Camera.prototype.onMouseDrag = function(event) {
        var s, x, y;
        x = event.clientX - this.mouseX;
        y = event.clientY - this.mouseY;
        this.mouseX = event.clientX;
        this.mouseY = event.clientY;
        if (this.downPos.dist(vec(this.mouseX, this.mouseY)) > 60) {
            this.mouseMoved = true;
        }
        if (event.buttons & 4) {
            s = this.dist;
            this.pan(x * 2 * s / this.size.x, y * s / this.size.y);
        }
        if (event.buttons & 3) {
            return this.pivot(4000 * x / this.size.x, 2000 * y / this.size.y);
        }
    };

    Camera.prototype.pivot = function(x, y) {
        this.rotate += 0.1 * x;
        this.degree += 0.1 * y;
        return this.navigate();
    };

    Camera.prototype.pan = function(x, y) {
        var ref2, right, up;
        right = vec(-x, 0, 0);
        right.applyQuaternion(this.rotationQuaternion);
        up = vec(0, y, 0);
        up.applyQuaternion(this.rotationQuaternion);
        this.center.add(right.plus(up));
        if ((ref2 = this.centerTarget) != null) {
            ref2.copy(this.center);
        }
        return this.navigate();
    };

    Camera.prototype.fadeToPos = function(v) {
        this.centerTarget = vec(v);
        return this.startFadeCenter();
    };

    Camera.prototype.startFadeCenter = function() {
        if (!this.fading) {
            animate(this.fadeCenter);
            return this.fading = true;
        }
    };

    Camera.prototype.fadeCenter = function(deltaSeconds) {
        if (!this.fading) {
            return;
        }
        this.center.fade(this.centerTarget, deltaSeconds);
        this.navigate();
        if (this.center.dist(this.centerTarget) > 0.00001) {
            animate(this.fadeCenter);
            return true;
        } else {
            return delete this.fading;
        }
    };

    Camera.prototype.moveForward = function() {
        return this.startMove(this.moveZ = 1);
    };

    Camera.prototype.moveRight = function() {
        return this.startMove(this.moveX = 1);
    };

    Camera.prototype.moveUp = function() {
        return this.startMove(this.moveY = 1);
    };

    Camera.prototype.moveLeft = function() {
        return this.startMove(this.moveX = -1);
    };

    Camera.prototype.moveDown = function() {
        return this.startMove(this.moveY = -1);
    };

    Camera.prototype.moveBackward = function() {
        return this.startMove(this.moveZ = -1);
    };

    Camera.prototype.stopRight = function() {
        return this.moveX = clamp(-1, 0, this.moveX);
    };

    Camera.prototype.stopLeft = function() {
        return this.moveX = clamp(0, 1, this.moveX);
    };

    Camera.prototype.stopUp = function() {
        return this.moveY = clamp(-1, 0, this.moveY);
    };

    Camera.prototype.stopDown = function() {
        return this.moveY = clamp(0, 1, this.moveY);
    };

    Camera.prototype.stopForward = function() {
        return this.moveZ = clamp(-1, 0, this.moveZ);
    };

    Camera.prototype.stopBackward = function() {
        return this.moveZ = clamp(0, 1, this.moveZ);
    };

    Camera.prototype.stopMoving = function() {
        this.moving = false;
        this.moveX = 0;
        this.moveY = 0;
        return this.moveZ = 0;
    };

    Camera.prototype.startMove = function() {
        this.fading = false;
        if (!this.moving) {
            this.dist = this.minDist;
            this.center = this.position.plus(this.getDir().mul(this.dist));
            animate(this.moveCenter);
            return this.moving = true;
        }
    };

    Camera.prototype.moveCenter = function(deltaSeconds) {
        var dir;
        if (!this.moving) {
            return;
        }
        dir = vec();
        dir.add(Vect.unitX.mul(10 * (this.moveX || this.moveFade.x)));
        dir.add(Vect.unitY.mul(10 * (this.moveY || this.moveFade.y)));
        dir.add(Vect.unitZ.mul(10 * (this.moveZ || this.moveFade.z)));
        dir.scale(deltaSeconds);
        this.rotationQuaternion.rotate(dir);
        this.center.add(dir);
        this.navigate();
        this.moveFade.x = this.moveX || reduce(this.moveFade.x, deltaSeconds);
        this.moveFade.y = this.moveY || reduce(this.moveFade.y, deltaSeconds);
        this.moveFade.z = this.moveZ || reduce(this.moveFade.z, deltaSeconds);
        if (this.moveFade.length() > 0.001) {
            return animate(this.moveCenter);
        } else {
            return this.stopMoving();
        }
    };

    Camera.prototype.onMouseWheel = function(event) {
        if (this.wheelInert > 0 && event.wheelDelta < 0) {
            this.wheelInert = 0;
            return;
        }
        if (this.wheelInert < 0 && event.wheelDelta > 0) {
            this.wheelInert = 0;
            return;
        }
        this.wheelInert += event.wheelDelta * (1 + (this.dist / this.maxDist) * 3) * 0.0001;
        return this.startZoom();
    };

    Camera.prototype.startZoomIn = function() {
        this.wheelInert = (1 + (this.dist / this.maxDist) * 3) * 10;
        return this.startZoom();
    };

    Camera.prototype.startZoomOut = function() {
        this.wheelInert = -(1 + (this.dist / this.maxDist) * 3) * 10;
        return this.startZoom();
    };

    Camera.prototype.startZoom = function() {
        if (!this.zooming) {
            animate(this.inertZoom);
            return this.zooming = true;
        }
    };

    Camera.prototype.stopZoom = function() {
        this.wheelInert = 0;
        return this.zooming = false;
    };

    Camera.prototype.inertZoom = function(deltaSeconds) {
        this.setDist(1 - clamp(-0.02, 0.02, this.wheelInert));
        this.wheelInert = reduce(this.wheelInert, deltaSeconds * 0.2);
        if (Math.abs(this.wheelInert) > 0.00000001) {
            animate(this.inertZoom);
            return true;
        } else {
            delete this.zooming;
            return this.wheelInert = 0;
        }
    };

    Camera.prototype.setDist = function(factor) {
        this.dist = clamp(this.minDist, this.maxDist, this.dist * factor);
        return this.navigate();
    };

    Camera.prototype.setFov = function(fov) {
        return this.fov = Math.max(2.0, Math.min(fov, 175.0));
    };

    Camera.prototype.navigate = function() {
        var pitch, yaw;
        this.degree = clamp(1, 179, this.degree);
        yaw = deg2rad(this.rotate);
        pitch = deg2rad(this.degree);
        this.rotationQuaternion.copyFrom(Quat.RotationYawPitchRoll(yaw, pitch, 0));
        this.position.copyFrom(this.center.plus(this.rotationQuaternion.rotate(vec(0, 0 - this.dist))));
        this.setTarget(this.center);
        if (18 * this.minDist / this.dist >= 8) {
            return this.scene.style.fontSize = 18 * this.minDist / this.dist;
        } else {
            return this.scene.style.fontSize = 0;
        }
    };

    return Camera;

})(UniversalCamera);

module.exports = Camera;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FtZXJhLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSxvSEFBQTtJQUFBOzs7O0FBUUEsTUFBNkIsT0FBQSxDQUFRLEtBQVIsQ0FBN0IsRUFBRSxxQkFBRixFQUFXLG1CQUFYLEVBQW1COztBQUNuQixPQUFnRCxPQUFBLENBQVEsV0FBUixDQUFoRCxFQUFFLGdDQUFGLEVBQWdCLHNDQUFoQixFQUFpQzs7QUFFakMsSUFBQSxHQUFPLE9BQUEsQ0FBUSxRQUFSOztBQUNQLElBQUEsR0FBTyxPQUFBLENBQVEsUUFBUjs7QUFFUCxPQUFBLEdBQVUsT0FBQSxDQUFRLFdBQVI7O0FBRVYsR0FBQSxHQUFNLFNBQUMsQ0FBRCxFQUFHLENBQUgsRUFBSyxDQUFMO1dBQVcsSUFBSSxJQUFKLENBQVMsQ0FBVCxFQUFZLENBQVosRUFBZSxDQUFmO0FBQVg7O0FBQ04sSUFBQSxHQUFPLFNBQUMsQ0FBRCxFQUFHLENBQUgsRUFBSyxDQUFMLEVBQU8sQ0FBUDtXQUFhLElBQUksSUFBSixDQUFTLENBQVQsRUFBWSxDQUFaLEVBQWUsQ0FBZixFQUFrQixDQUFsQjtBQUFiOztBQUVEOzs7SUFFQyxnQkFBQyxLQUFELEVBQVMsSUFBVCxFQUFnQixNQUFoQjtBQUVDLFlBQUE7UUFGQSxJQUFDLENBQUEsUUFBRDtRQUFRLElBQUMsQ0FBQSxPQUFEO1FBQU8sSUFBQyxDQUFBLFNBQUQ7Ozs7Ozs7Ozs7UUFFZixLQUFBLEdBQVMsSUFBQyxDQUFBLElBQUksQ0FBQztRQUNmLE1BQUEsR0FBUyxJQUFDLENBQUEsSUFBSSxDQUFDO1FBRWYsSUFBQyxDQUFBLElBQUQsR0FBYyxHQUFBLENBQUksS0FBSixFQUFXLE1BQVg7UUFDZCxJQUFDLENBQUEsSUFBRCxHQUFjO1FBQ2QsSUFBQyxDQUFBLE9BQUQsR0FBYztRQUNkLElBQUMsQ0FBQSxPQUFELEdBQWM7UUFDZCxJQUFDLENBQUEsTUFBRCxHQUFj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QUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4gMDAwMDAwMCAgIDAwMDAwMDAgICAwMCAgICAgMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgICAwMDAwMDAwIFxuMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDBcbjAwMCAgICAgICAwMDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMDAwXG4wMDAgICAgICAgMDAwICAgMDAwICAwMDAgMCAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDBcbiMjI1xuXG57IGRlZzJyYWQsIHJlZHVjZSwgY2xhbXAgfSA9IHJlcXVpcmUgJ2t4aydcbnsgVGFyZ2V0Q2FtZXJhLCBVbml2ZXJzYWxDYW1lcmEsIFBvaW50TGlnaHQgfSA9IHJlcXVpcmUgJ2JhYnlsb25qcydcblxuVmVjdCA9IHJlcXVpcmUgJy4vdmVjdCdcblF1YXQgPSByZXF1aXJlICcuL3F1YXQnXG5cbmFuaW1hdGUgPSByZXF1aXJlICcuL2FuaW1hdGUnXG5cbnZlYyA9ICh4LHkseikgLT4gbmV3IFZlY3QgeCwgeSwgelxucXVhdCA9ICh4LHkseix3KSAtPiBuZXcgUXVhdCB4LCB5LCB6LCB3XG5cbmNsYXNzIENhbWVyYSBleHRlbmRzIFVuaXZlcnNhbENhbWVyYVxuXG4gICAgQDogKEBzY2VuZSwgQHZpZXcsIEBjYW52YXMpIC0+XG4gICAgICAgIFxuICAgICAgICB3aWR0aCAgPSBAdmlldy5jbGllbnRXaWR0aFxuICAgICAgICBoZWlnaHQgPSBAdmlldy5jbGllbnRIZWlnaHRcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgQHNpemUgICAgICAgPSB2ZWMgd2lkdGgsIGhlaWdodFxuICAgICAgICBAZGlzdCAgICAgICA9IDEwXG4gICAgICAgIEBtYXhEaXN0ICAgID0gMTAwXG4gICAgICAgIEBtaW5EaXN0ICAgID0gM1xuICAgICAgICBAY2VudGVyICAgICA9IHZlYyAwIDAgMFxuICAgICAgICBAbW92ZUZhZGUgICA9IHZlYyAwIDAgMFxuICAgICAgICBAZGVncmVlICAgICA9IDkwXG4gICAgICAgIEByb3RhdGUgICAgID0gMFxuICAgICAgICBAd2hlZWxJbmVydCA9IDBcbiAgICAgICAgQHBpdm90WCAgICAgPSAwXG4gICAgICAgIEBwaXZvdFkgICAgID0gMFxuICAgICAgICBAbW92ZVggICAgICA9IDBcbiAgICAgICAgQG1vdmVZICAgICAgPSAwXG4gICAgICAgIEBtb3ZlWiAgICAgID0gMFxuICAgICAgICBAcXVhdCAgICAgICA9IHF1YXQoKVxuXG4gICAgICAgIHN1cGVyICdDYW1lcmEnIHZlYygwIC0xMCAwKSwgQHNjZW5lXG5cbiAgICAgICAgQHJvdGF0aW9uUXVhdGVybmlvbiA9IG5ldyBRdWF0KClcbiAgICAgICAgQHNldFRhcmdldCBAY2VudGVyXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIEBpbmVydGlhID0gMC44XG4gICAgICAgIFxuICAgICAgICBAbGlnaHQgPSBuZXcgUG9pbnRMaWdodCAnc3BvdCcgQHBvc2l0aW9uLCBAc2NlbmVcbiAgICAgICAgQGxpZ2h0LmludGVuc2l0eSA9IDAuNVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgIEB2aWV3LmFkZEV2ZW50TGlzdGVuZXIgJ21vdXNld2hlZWwnIEBvbk1vdXNlV2hlZWxcbiAgICAgICAgQG5hdmlnYXRlKClcblxuICAgIGdldERpcjogICAgLT4gQHJvdGF0aW9uUXVhdGVybmlvbi5yb3RhdGVkIFZlY3QudW5pdFpcbiAgICBnZXRVcDogICAgIC0+IEByb3RhdGlvblF1YXRlcm5pb24ucm90YXRlZCBWZWN0LnVuaXRZXG4gICAgZ2V0UmlnaHQ6ICAtPiBAcm90YXRpb25RdWF0ZXJuaW9uLnJvdGF0ZWQgVmVjdC51bml0WFxuXG4gICAgc2V0Q2VudGVyOiAocCkgLT5cblxuICAgICAgICBAY2VudGVyID0gdmVjIHBcbiAgICAgICAgQG5hdmlnYXRlKClcbiAgICBcbiAgICBkZWw6ID0+XG4gICAgICAgIFxuICAgICAgICBAdmlldy5yZW1vdmVFdmVudExpc3RlbmVyICAnbW91c2V3aGVlbCcgQG9uTW91c2VXaGVlbFxuICAgICAgICBcbiAgICAjIDAwICAgICAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAwIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIFxuICAgIFxuICAgIG9uTW91c2VEb3duOiAoZXZlbnQpID0+IFxuICAgICAgICBcbiAgICAgICAgQGRvd25CdXR0b25zID0gZXZlbnQuYnV0dG9uc1xuICAgICAgICBAbW91c2VNb3ZlZCAgPSBmYWxzZVxuICAgICAgICAgICAgXG4gICAgICAgIEBtb3VzZVggPSBldmVudC5jbGllbnRYXG4gICAgICAgIEBtb3VzZVkgPSBldmVudC5jbGllbnRZXG4gICAgICAgIFxuICAgICAgICBAZG93blBvcyA9IHZlYyBAbW91c2VYLCBAbW91c2VZXG4gICAgICAgIFxuICAgIG9uTW91c2VVcDogKGV2ZW50KSA9PiAja2xvZyAndXAnXG5cbiAgICBvbk1vdXNlRHJhZzogKGV2ZW50KSA9PlxuXG4gICAgICAgIHggPSBldmVudC5jbGllbnRYLUBtb3VzZVhcbiAgICAgICAgeSA9IGV2ZW50LmNsaWVudFktQG1vdXNlWVxuXG4gICAgICAgIEBtb3VzZVggPSBldmVudC5jbGllbnRYXG4gICAgICAgIEBtb3VzZVkgPSBldmVudC5jbGllbnRZXG4gICAgICAgIFxuICAgICAgICBpZiBAZG93blBvcy5kaXN0KHZlYyBAbW91c2VYLCBAbW91c2VZKSA+IDYwXG4gICAgICAgICAgICBAbW91c2VNb3ZlZCA9IHRydWVcbiAgICAgICAgXG4gICAgICAgIGlmIGV2ZW50LmJ1dHRvbnMgJiA0XG4gICAgICAgICAgICBzID0gQGRpc3RcbiAgICAgICAgICAgIEBwYW4geCoyKnMvQHNpemUueCwgeSpzL0BzaXplLnlcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBldmVudC5idXR0b25zICYgM1xuICAgICAgICAgICAgQHBpdm90IDQwMDAqeC9Ac2l6ZS54LCAyMDAwKnkvQHNpemUueSAgICAgICAgICAgIFxuICAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMCAgIDAwMCAwMDAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAgICAgIDAgICAgICAgMDAwMDAwMCAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgcGl2b3Q6ICh4LHkpIC0+XG4gICAgICAgICBcbiAgICAgICAgQHJvdGF0ZSArPSAwLjEqeFxuICAgICAgICBAZGVncmVlICs9IDAuMSp5XG4gICAgICAgICAgICAgICAgIFxuICAgICAgICBAbmF2aWdhdGUoKVxuICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICBcbiAgICAjIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgIDAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgcGFuOiAoeCx5KSAtPlxuICAgICAgICBcbiAgICAgICAgcmlnaHQgPSB2ZWMgLXgsIDAsIDAgXG4gICAgICAgIHJpZ2h0LmFwcGx5UXVhdGVybmlvbiBAcm90YXRpb25RdWF0ZXJuaW9uXG5cbiAgICAgICAgdXAgPSB2ZWMgMCwgeSwgMCBcbiAgICAgICAgdXAuYXBwbHlRdWF0ZXJuaW9uIEByb3RhdGlvblF1YXRlcm5pb25cbiAgICAgICAgXG4gICAgICAgIEBjZW50ZXIuYWRkIHJpZ2h0LnBsdXMgdXBcbiAgICAgICAgQGNlbnRlclRhcmdldD8uY29weSBAY2VudGVyXG4gICAgICAgIEBuYXZpZ2F0ZSgpXG4gICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMCAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgICAgMDAwICBcbiAgICAjIDAwMCAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAgICBcbiAgICAgICAgICAgICAgICAgICAgIFxuICAgIGZhZGVUb1BvczogKHYpIC0+IFxuICAgICAgICBcbiAgICAgICAgQGNlbnRlclRhcmdldCA9IHZlYyB2XG4gICAgICAgIEBzdGFydEZhZGVDZW50ZXIoKVxuXG4gICAgc3RhcnRGYWRlQ2VudGVyOiAtPiBcbiAgICAgICAgXG4gICAgICAgIGlmIG5vdCBAZmFkaW5nXG4gICAgICAgICAgICBhbmltYXRlIEBmYWRlQ2VudGVyXG4gICAgICAgICAgICBAZmFkaW5nID0gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgZmFkZUNlbnRlcjogKGRlbHRhU2Vjb25kcykgPT5cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBpZiBub3QgQGZhZGluZ1xuICAgICAgICBcbiAgICAgICAgQGNlbnRlci5mYWRlIEBjZW50ZXJUYXJnZXQsIGRlbHRhU2Vjb25kc1xuICAgICAgICBAbmF2aWdhdGUoKVxuICAgICAgICBcbiAgICAgICAgaWYgQGNlbnRlci5kaXN0KEBjZW50ZXJUYXJnZXQpID4gMC4wMDAwMVxuICAgICAgICAgICAgYW5pbWF0ZSBAZmFkZUNlbnRlclxuICAgICAgICAgICAgdHJ1ZVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBkZWxldGUgQGZhZGluZ1xuXG4gICAgIyAwMCAgICAgMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMCAwMDAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgICAwMDAwMDAwICAgICAgIDAgICAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgbW92ZUZvcndhcmQ6ICAtPiBAc3RhcnRNb3ZlIEBtb3ZlWiA9IDFcbiAgICBtb3ZlUmlnaHQ6ICAgIC0+IEBzdGFydE1vdmUgQG1vdmVYID0gMVxuICAgIG1vdmVVcDogICAgICAgLT4gQHN0YXJ0TW92ZSBAbW92ZVkgPSAxXG4gICAgbW92ZUxlZnQ6ICAgICAtPiBAc3RhcnRNb3ZlIEBtb3ZlWCA9IC0xXG4gICAgbW92ZURvd246ICAgICAtPiBAc3RhcnRNb3ZlIEBtb3ZlWSA9IC0xXG4gICAgbW92ZUJhY2t3YXJkOiAtPiBAc3RhcnRNb3ZlIEBtb3ZlWiA9IC0xICAgICAgICAgIFxuXG4gICAgc3RvcFJpZ2h0OiAgICAtPiBAbW92ZVggPSBjbGFtcCAtMSAwIEBtb3ZlWFxuICAgIHN0b3BMZWZ0OiAgICAgLT4gQG1vdmVYID0gY2xhbXAgIDAgMSBAbW92ZVhcbiAgICBzdG9wVXA6ICAgICAgIC0+IEBtb3ZlWSA9IGNsYW1wIC0xIDAgQG1vdmVZXG4gICAgc3RvcERvd246ICAgICAtPiBAbW92ZVkgPSBjbGFtcCAgMCAxIEBtb3ZlWVxuICAgIHN0b3BGb3J3YXJkOiAgLT4gQG1vdmVaID0gY2xhbXAgLTEgMCBAbW92ZVpcbiAgICBzdG9wQmFja3dhcmQ6IC0+IEBtb3ZlWiA9IGNsYW1wICAwIDEgQG1vdmVaXG4gICAgICAgIFxuICAgIHN0b3BNb3Zpbmc6IC0+XG4gICAgICAgIFxuICAgICAgICBAbW92aW5nID0gZmFsc2VcbiAgICAgICAgQG1vdmVYID0gMFxuICAgICAgICBAbW92ZVkgPSAwXG4gICAgICAgIEBtb3ZlWiA9IDBcbiAgICAgICBcbiAgICBzdGFydE1vdmU6IC0+IFxuICAgICAgICBcbiAgICAgICAgQGZhZGluZyA9IGZhbHNlXG4gICAgICAgIGlmIG5vdCBAbW92aW5nXG4gICAgICAgICAgICBAZGlzdCA9IEBtaW5EaXN0XG4gICAgICAgICAgICBAY2VudGVyID0gQHBvc2l0aW9uLnBsdXMgQGdldERpcigpLm11bCBAZGlzdFxuICAgICAgICAgICAgYW5pbWF0ZSBAbW92ZUNlbnRlclxuICAgICAgICAgICAgQG1vdmluZyA9IHRydWVcbiAgICAgICAgICAgIFxuICAgIG1vdmVDZW50ZXI6IChkZWx0YVNlY29uZHMpID0+XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gaWYgbm90IEBtb3ZpbmdcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgZGlyID0gdmVjKClcbiAgICAgICAgZGlyLmFkZCBWZWN0LnVuaXRYLm11bCAxMCAqIChAbW92ZVggb3IgQG1vdmVGYWRlLngpXG4gICAgICAgIGRpci5hZGQgVmVjdC51bml0WS5tdWwgMTAgKiAoQG1vdmVZIG9yIEBtb3ZlRmFkZS55KVxuICAgICAgICBkaXIuYWRkIFZlY3QudW5pdFoubXVsIDEwICogKEBtb3ZlWiBvciBAbW92ZUZhZGUueilcbiAgICAgICAgXG4gICAgICAgIGRpci5zY2FsZSBkZWx0YVNlY29uZHNcbiAgICAgICAgQHJvdGF0aW9uUXVhdGVybmlvbi5yb3RhdGUgZGlyXG4gICAgICAgIFxuICAgICAgICBAY2VudGVyLmFkZCBkaXJcbiAgICAgICAgQG5hdmlnYXRlKClcbiAgICAgICAgXG4gICAgICAgIEBtb3ZlRmFkZS54ID0gQG1vdmVYIG9yIHJlZHVjZSBAbW92ZUZhZGUueCwgZGVsdGFTZWNvbmRzXG4gICAgICAgIEBtb3ZlRmFkZS55ID0gQG1vdmVZIG9yIHJlZHVjZSBAbW92ZUZhZGUueSwgZGVsdGFTZWNvbmRzXG4gICAgICAgIEBtb3ZlRmFkZS56ID0gQG1vdmVaIG9yIHJlZHVjZSBAbW92ZUZhZGUueiwgZGVsdGFTZWNvbmRzXG4gICAgICAgIFxuICAgICAgICBpZiBAbW92ZUZhZGUubGVuZ3RoKCkgPiAwLjAwMVxuICAgICAgICAgICAgYW5pbWF0ZSBAbW92ZUNlbnRlclxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAc3RvcE1vdmluZygpXG4gICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgICAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICBcbiAgICAjIDAwMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgICAgXG4gICAgIyAwMCAgICAgMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICBcbiAgICBcbiAgICBvbk1vdXNlV2hlZWw6IChldmVudCkgPT4gXG4gICAgICAgICAgICBcbiAgICAgICAgaWYgQHdoZWVsSW5lcnQgPiAwIGFuZCBldmVudC53aGVlbERlbHRhIDwgMFxuICAgICAgICAgICAgQHdoZWVsSW5lcnQgPSAwXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIFxuICAgICAgICBpZiBAd2hlZWxJbmVydCA8IDAgYW5kIGV2ZW50LndoZWVsRGVsdGEgPiAwXG4gICAgICAgICAgICBAd2hlZWxJbmVydCA9IDBcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgXG4gICAgICAgIEB3aGVlbEluZXJ0ICs9IGV2ZW50LndoZWVsRGVsdGEgKiAoMSsoQGRpc3QvQG1heERpc3QpKjMpICogMC4wMDAxXG4gICAgICAgIFxuICAgICAgICBAc3RhcnRab29tKClcblxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwICAgICAwMCAgXG4gICAgIyAgICAwMDAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjICAgMDAwICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMDAgIFxuICAgICMgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgMDAwICBcblxuICAgIHN0YXJ0Wm9vbUluOiAtPlxuICAgICAgICBcbiAgICAgICAgQHdoZWVsSW5lcnQgPSAoMSsoQGRpc3QvQG1heERpc3QpKjMpKjEwXG4gICAgICAgIEBzdGFydFpvb20oKVxuICAgICAgICBcbiAgICBzdGFydFpvb21PdXQ6IC0+XG4gICAgICAgIFxuICAgICAgICBAd2hlZWxJbmVydCA9IC0oMSsoQGRpc3QvQG1heERpc3QpKjMpKjEwXG4gICAgICAgIEBzdGFydFpvb20oKVxuICAgIFxuICAgIHN0YXJ0Wm9vbTogLT4gXG4gICAgICAgIFxuICAgICAgICBpZiBub3QgQHpvb21pbmdcbiAgICAgICAgICAgIGFuaW1hdGUgQGluZXJ0Wm9vbVxuICAgICAgICAgICAgQHpvb21pbmcgPSB0cnVlXG4gICAgICAgICAgICBcbiAgICBzdG9wWm9vbTogLT4gXG4gICAgICAgIFxuICAgICAgICBAd2hlZWxJbmVydCA9IDBcbiAgICAgICAgQHpvb21pbmcgPSBmYWxzZVxuICAgIFxuICAgIGluZXJ0Wm9vbTogKGRlbHRhU2Vjb25kcykgPT5cblxuICAgICAgICBAc2V0RGlzdCAxIC0gY2xhbXAgLTAuMDIgMC4wMiBAd2hlZWxJbmVydFxuICAgICAgICBAd2hlZWxJbmVydCA9IHJlZHVjZSBAd2hlZWxJbmVydCwgZGVsdGFTZWNvbmRzKjAuMlxuICAgICAgICBpZiBNYXRoLmFicyhAd2hlZWxJbmVydCkgPiAwLjAwMDAwMDAxXG4gICAgICAgICAgICBhbmltYXRlIEBpbmVydFpvb21cbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgZGVsZXRlIEB6b29taW5nXG4gICAgICAgICAgICBAd2hlZWxJbmVydCA9IDBcbiAgICBcbiAgICBzZXREaXN0OiAoZmFjdG9yKSA9PlxuICAgICAgICAgICAgICAgIFxuICAgICAgICBAZGlzdCA9IGNsYW1wIEBtaW5EaXN0LCBAbWF4RGlzdCwgQGRpc3QqZmFjdG9yXG4gICAgICAgIEBuYXZpZ2F0ZSgpXG4gICAgICAgIFxuICAgIHNldEZvdjogKGZvdikgLT4gQGZvdiA9IE1hdGgubWF4KDIuMCBNYXRoLm1pbiBmb3YsIDE3NS4wKVxuICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwICAgICAgICAwMDAwMDAwICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgbmF2aWdhdGU6IC0+IFxuICAgICAgICBcbiAgICAgICAgQGRlZ3JlZSA9IGNsYW1wIDEgMTc5IEBkZWdyZWVcbiAgICAgICAgXG4gICAgICAgIHlhdyAgID0gZGVnMnJhZCBAcm90YXRlXG4gICAgICAgIHBpdGNoID0gZGVnMnJhZCBAZGVncmVlXG4gICAgICAgIEByb3RhdGlvblF1YXRlcm5pb24uY29weUZyb20gUXVhdC5Sb3RhdGlvbllhd1BpdGNoUm9sbCB5YXcsIHBpdGNoLCAwXG4gICAgICAgIEBwb3NpdGlvbi5jb3B5RnJvbSBAY2VudGVyLnBsdXMgQHJvdGF0aW9uUXVhdGVybmlvbi5yb3RhdGUgdmVjKDAgMCAtQGRpc3QpXG4gICAgICAgIEBzZXRUYXJnZXQgQGNlbnRlclxuICAgICAgICBcbiAgICAgICAgaWYgMTgqQG1pbkRpc3QvQGRpc3QgPj0gOFxuICAgICAgICAgICAgQHNjZW5lLnN0eWxlLmZvbnRTaXplID0gMTgqQG1pbkRpc3QvQGRpc3RcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQHNjZW5lLnN0eWxlLmZvbnRTaXplID0gMFxuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID0gQ2FtZXJhXG4iXX0=
//# sourceURL=../coffee/camera.coffee