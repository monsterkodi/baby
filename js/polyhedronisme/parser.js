// koffee 1.6.0
var PEG, add, basemap, generatePoly, getOps, opmap, parser, polyhedron, specreplacements, topo;

add = require('./geo').add;

PEG = require('pegjs');

parser = PEG.generate("/* series of opspecs */\nstart  = opspec+\n\n/* opspec one of:\n A  - single letter\n A3 - single letter and float\n B(5,4.3,3) - function call format w. float args\n*/\nopspec \n    = lettr:opcode args:opargs {return {\"op\":lettr,\"args\":args};}\n    / lettr:opcode float:float {return {\"op\":lettr,\"args\":[float]};}\n    / lettr:opcode             {return {\"op\":lettr,\"args\":[]};}\n\n/*\nparentheses surrounding comma-delimited list of floats i.e.\n( 1 , 3.2, 4 ) or (1) or (2,3)\n*/\nopargs = \"(\"\n           num:( float:float \",\"? {return float} )+\n         \")\" {return num;}\n\n/* just a letter */\nopcode = op:[a-zA-Z] {return op;}\n\n/* standard numerical types */\nint   = digits:[0-9-]+   { return parseInt(digits.join(\"\"), 10);  }\nfloat = digits:[0-9.-]+  { return parseFloat(digits.join(\"\"), 10); }");

polyhedron = require('./polyhedron');

basemap = {
    T: polyhedron.tetrahedron,
    O: polyhedron.octahedron,
    C: polyhedron.cube,
    I: polyhedron.icosahedron,
    D: polyhedron.dodecahedron,
    P: polyhedron.prism,
    A: polyhedron.antiprism,
    Y: polyhedron.pyramid,
    J: polyhedron.johnson,
    U: polyhedron.cupola,
    V: polyhedron.anticupola
};

topo = require('./topo');

opmap = {
    d: topo.dual,
    a: topo.ambo,
    k: topo.kisN,
    g: topo.gyro,
    p: topo.propellor,
    r: topo.reflect,
    c: topo.chamfer,
    w: topo.whirl,
    n: topo.insetN,
    x: topo.extrudeN,
    l: topo.loft,
    P: topo.perspectiva1,
    q: topo.quinto,
    u: topo.trisub,
    H: topo.hollow,
    Z: topo.triangulate,
    C: topo.canonicalize,
    A: topo.adjustXY
};

specreplacements = [[/e/g, "aa"], [/b/g, "ta"], [/o/g, "jj"], [/m/g, "kj"], [/t(\d*)/g, "dk$1d"], [/j/g, "dad"], [/s/g, "dgd"], [/dd/g, ""], [/ad/g, "a"], [/gd/g, "g"], [/aO/g, "aC"], [/aI/g, "aD"], [/gO/g, "gC"], [/gI/g, "gD"]];

getOps = function(notation) {
    var equiv, expanded, i, len, orig, ref;
    expanded = notation;
    for (i = 0, len = specreplacements.length; i < len; i++) {
        ref = specreplacements[i], orig = ref[0], equiv = ref[1];
        expanded = expanded.replace(orig, equiv);
    }
    console.log(notation + " executed as " + expanded);
    return expanded;
};

generatePoly = function(notation) {
    var baseargs, basefunc, dispatch, i, len, op, opargs, opfunc, oplist, ops_spec, poly;
    dispatch = function(fn, args) {
        return fn.apply(fn, args || []);
    };
    ops_spec = getOps(notation);
    oplist = parser.parse(ops_spec).reverse();
    op = oplist.shift();
    basefunc = basemap[op["op"]];
    baseargs = op["args"];
    poly = dispatch(basefunc, baseargs);
    for (i = 0, len = oplist.length; i < len; i++) {
        op = oplist[i];
        opfunc = opmap[op["op"]];
        opargs = [poly].concat(op["args"]);
        poly = dispatch(opfunc, opargs);
    }
    poly.vertices = recenter(poly.vertices, poly.edges());
    poly.vertices = rescale(poly.vertices);
    return poly = paintPolyhedron(poly);
};

generatePoly('tT');

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2VyLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBYUEsSUFBQTs7QUFBRSxNQUFRLE9BQUEsQ0FBUSxPQUFSOztBQUVWLEdBQUEsR0FBTSxPQUFBLENBQVEsT0FBUjs7QUFFTixNQUFBLEdBQVMsR0FBRyxDQUFDLFFBQUosQ0FBYSxnMEJBQWI7O0FBOEJULFVBQUEsR0FBYSxPQUFBLENBQVEsY0FBUjs7QUFFYixPQUFBLEdBQ0k7SUFBQSxDQUFBLEVBQUcsVUFBVSxDQUFDLFdBQWQ7SUFDQSxDQUFBLEVBQUcsVUFBVSxDQUFDLFVBRGQ7SUFFQSxDQUFBLEVBQUcsVUFBVSxDQUFDLElBRmQ7SUFHQSxDQUFBLEVBQUcsVUFBVSxDQUFDLFdBSGQ7SUFJQSxDQUFBLEVBQUcsVUFBVSxDQUFDLFlBSmQ7SUFLQSxDQUFBLEVBQUcsVUFBVSxDQUFDLEtBTGQ7SUFNQSxDQUFBLEVBQUcsVUFBVSxDQUFDLFNBTmQ7SUFPQSxDQUFBLEVBQUcsVUFBVSxDQUFDLE9BUGQ7SUFRQSxDQUFBLEVBQUcsVUFBVSxDQUFDLE9BUmQ7SUFTQSxDQUFBLEVBQUcsVUFBVSxDQUFDLE1BVGQ7SUFVQSxDQUFBLEVBQUcsVUFBVSxDQUFDLFVBVmQ7OztBQVlKLElBQUEsR0FBTyxPQUFBLENBQVEsUUFBUjs7QUFFUCxLQUFBLEdBQ0k7SUFBQSxDQUFBLEVBQUcsSUFBSSxDQUFDLElBQVI7SUFDQSxDQUFBLEVBQUcsSUFBSSxDQUFDLElBRFI7SUFFQSxDQUFBLEVBQUcsSUFBSSxDQUFDLElBRlI7SUFHQSxDQUFBLEVBQUcsSUFBSSxDQUFDLElBSFI7SUFJQSxDQUFBLEVBQUcsSUFBSSxDQUFDLFNBSlI7SUFLQSxDQUFBLEVBQUcsSUFBSSxDQUFDLE9BTFI7SUFNQSxDQUFBLEVBQUcsSUFBSSxDQUFDLE9BTlI7SUFPQSxDQUFBLEVBQUcsSUFBSSxDQUFDLEtBUFI7SUFRQSxDQUFBLEVBQUcsSUFBSSxDQUFDLE1BUlI7SUFTQSxDQUFBLEVBQUcsSUFBSSxDQUFDLFFBVFI7SUFVQSxDQUFBLEVBQUcsSUFBSSxDQUFDLElBVlI7SUFXQSxDQUFBLEVBQUcsSUFBSSxDQUFDLFlBWFI7SUFZQSxDQUFBLEVBQUcsSUFBSSxDQUFDLE1BWlI7SUFhQSxDQUFBLEVBQUcsSUFBSSxDQUFDLE1BYlI7SUFjQSxDQUFBLEVBQUcsSUFBSSxDQUFDLE1BZFI7SUFlQSxDQUFBLEVBQUcsSUFBSSxDQUFDLFdBZlI7SUFnQkEsQ0FBQSxFQUFHLElBQUksQ0FBQyxZQWhCUjtJQWlCQSxDQUFBLEVBQUcsSUFBSSxDQUFDLFFBakJSOzs7QUFvQkosZ0JBQUEsR0FBbUIsQ0FDZixDQUFDLElBQUQsRUFBTyxJQUFQLENBRGUsRUFFZixDQUFDLElBQUQsRUFBTyxJQUFQLENBRmUsRUFHZixDQUFDLElBQUQsRUFBTyxJQUFQLENBSGUsRUFJZixDQUFDLElBQUQsRUFBTyxJQUFQLENBSmUsRUFLZixDQUFDLFNBQUQsRUFBWSxPQUFaLENBTGUsRUFNZixDQUFDLElBQUQsRUFBTyxLQUFQLENBTmUsRUFPZixDQUFDLElBQUQsRUFBTyxLQUFQLENBUGUsRUFRZixDQUFDLEtBQUQsRUFBUSxFQUFSLENBUmUsRUFTZixDQUFDLEtBQUQsRUFBUSxHQUFSLENBVGUsRUFVZixDQUFDLEtBQUQsRUFBUSxHQUFSLENBVmUsRUFXZixDQUFDLEtBQUQsRUFBUSxJQUFSLENBWGUsRUFZZixDQUFDLEtBQUQsRUFBUSxJQUFSLENBWmUsRUFhZixDQUFDLEtBQUQsRUFBUSxJQUFSLENBYmUsRUFjZixDQUFDLEtBQUQsRUFBUSxJQUFSLENBZGU7O0FBaUJuQixNQUFBLEdBQVMsU0FBQyxRQUFEO0FBRUwsUUFBQTtJQUFBLFFBQUEsR0FBVztBQUNYLFNBQUEsa0RBQUE7bUNBQUssZUFBSztRQUNOLFFBQUEsR0FBVyxRQUFRLENBQUMsT0FBVCxDQUFpQixJQUFqQixFQUF1QixLQUF2QjtBQURmO0lBRUEsT0FBTyxDQUFDLEdBQVIsQ0FBZSxRQUFELEdBQVUsZUFBVixHQUF5QixRQUF2QztXQUNBO0FBTks7O0FBUVQsWUFBQSxHQUFlLFNBQUMsUUFBRDtBQUVYLFFBQUE7SUFBQSxRQUFBLEdBQVcsU0FBQyxFQUFELEVBQUssSUFBTDtlQUFjLEVBQUUsQ0FBQyxLQUFILENBQVMsRUFBVCxFQUFhLElBQUEsSUFBUSxFQUFyQjtJQUFkO0lBRVgsUUFBQSxHQUFXLE1BQUEsQ0FBTyxRQUFQO0lBQ1gsTUFBQSxHQUFTLE1BQU0sQ0FBQyxLQUFQLENBQWEsUUFBYixDQUFzQixDQUFDLE9BQXZCLENBQUE7SUFFVCxFQUFBLEdBQUssTUFBTSxDQUFDLEtBQVAsQ0FBQTtJQUNMLFFBQUEsR0FBVyxPQUFRLENBQUEsRUFBRyxDQUFBLElBQUEsQ0FBSDtJQUNuQixRQUFBLEdBQVcsRUFBRyxDQUFBLE1BQUE7SUFDZCxJQUFBLEdBQU8sUUFBQSxDQUFTLFFBQVQsRUFBbUIsUUFBbkI7QUFFUCxTQUFBLHdDQUFBOztRQUNJLE1BQUEsR0FBUyxLQUFNLENBQUEsRUFBRyxDQUFBLElBQUEsQ0FBSDtRQUNmLE1BQUEsR0FBUyxDQUFDLElBQUQsQ0FBTSxDQUFDLE1BQVAsQ0FBYyxFQUFHLENBQUEsTUFBQSxDQUFqQjtRQUNULElBQUEsR0FBTyxRQUFBLENBQVMsTUFBVCxFQUFpQixNQUFqQjtBQUhYO0lBTUEsSUFBSSxDQUFDLFFBQUwsR0FBZ0IsUUFBQSxDQUFTLElBQUksQ0FBQyxRQUFkLEVBQXdCLElBQUksQ0FBQyxLQUFMLENBQUEsQ0FBeEI7SUFDaEIsSUFBSSxDQUFDLFFBQUwsR0FBZ0IsT0FBQSxDQUFRLElBQUksQ0FBQyxRQUFiO1dBR2hCLElBQUEsR0FBTyxlQUFBLENBQWdCLElBQWhCO0FBdEJJOztBQXdCZixZQUFBLENBQWEsSUFBYiIsInNvdXJjZXNDb250ZW50IjpbIiMgUG9seWjDqWRyb25pc21lXG4jPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4jXG4jIEEgdG95IGZvciBjb25zdHJ1Y3RpbmcgYW5kIG1hbmlwdWxhdGluZyBwb2x5aGVkcmEgYW5kIG90aGVyIG1lc2hlc1xuI1xuIyBDb3B5cmlnaHQgMjAxOSwgQW5zZWxtIExldnNrYXlhXG4jIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZVxuXG4jIFBhcnNlciBSb3V0aW5lc1xuIz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4jIGZhaXJseSBzdHJhaWdodGZvcndhcmQgUGFyc2VyIEV4cHJlc3Npb24gR3JhbW1hciBzcGVjIGZvciBzaW1wbGUgb3BlcmF0b3ItY2hhaW4tb24tYmFzZS1wb2x5aGVkcmEgcmVjaXBlc1xuICAgIFxueyBhZGQgfSA9IHJlcXVpcmUgJy4vZ2VvJ1xuICAgIFxuUEVHID0gcmVxdWlyZSAncGVnanMnXG4gICAgXG5wYXJzZXIgPSBQRUcuZ2VuZXJhdGUgXCJcIlwiXG4gICAgLyogc2VyaWVzIG9mIG9wc3BlY3MgKi9cbiAgICBzdGFydCAgPSBvcHNwZWMrXG4gICAgXG4gICAgLyogb3BzcGVjIG9uZSBvZjpcbiAgICAgQSAgLSBzaW5nbGUgbGV0dGVyXG4gICAgIEEzIC0gc2luZ2xlIGxldHRlciBhbmQgZmxvYXRcbiAgICAgQig1LDQuMywzKSAtIGZ1bmN0aW9uIGNhbGwgZm9ybWF0IHcuIGZsb2F0IGFyZ3NcbiAgICAqL1xuICAgIG9wc3BlYyBcbiAgICAgICAgPSBsZXR0cjpvcGNvZGUgYXJnczpvcGFyZ3Mge3JldHVybiB7XCJvcFwiOmxldHRyLFwiYXJnc1wiOmFyZ3N9O31cbiAgICAgICAgLyBsZXR0cjpvcGNvZGUgZmxvYXQ6ZmxvYXQge3JldHVybiB7XCJvcFwiOmxldHRyLFwiYXJnc1wiOltmbG9hdF19O31cbiAgICAgICAgLyBsZXR0cjpvcGNvZGUgICAgICAgICAgICAge3JldHVybiB7XCJvcFwiOmxldHRyLFwiYXJnc1wiOltdfTt9XG4gICAgXG4gICAgLypcbiAgICBwYXJlbnRoZXNlcyBzdXJyb3VuZGluZyBjb21tYS1kZWxpbWl0ZWQgbGlzdCBvZiBmbG9hdHMgaS5lLlxuICAgICggMSAsIDMuMiwgNCApIG9yICgxKSBvciAoMiwzKVxuICAgICovXG4gICAgb3BhcmdzID0gXCIoXCJcbiAgICAgICAgICAgICAgIG51bTooIGZsb2F0OmZsb2F0IFwiLFwiPyB7cmV0dXJuIGZsb2F0fSApK1xuICAgICAgICAgICAgIFwiKVwiIHtyZXR1cm4gbnVtO31cbiAgICBcbiAgICAvKiBqdXN0IGEgbGV0dGVyICovXG4gICAgb3Bjb2RlID0gb3A6W2EtekEtWl0ge3JldHVybiBvcDt9XG4gICAgXG4gICAgLyogc3RhbmRhcmQgbnVtZXJpY2FsIHR5cGVzICovXG4gICAgaW50ICAgPSBkaWdpdHM6WzAtOS1dKyAgIHsgcmV0dXJuIHBhcnNlSW50KGRpZ2l0cy5qb2luKFwiXCIpLCAxMCk7ICB9XG4gICAgZmxvYXQgPSBkaWdpdHM6WzAtOS4tXSsgIHsgcmV0dXJuIHBhcnNlRmxvYXQoZGlnaXRzLmpvaW4oXCJcIiksIDEwKTsgfVxuICAgIFwiXCJcIlxuXG5wb2x5aGVkcm9uID0gcmVxdWlyZSAnLi9wb2x5aGVkcm9uJ1xuXG5iYXNlbWFwID0gXG4gICAgVDogcG9seWhlZHJvbi50ZXRyYWhlZHJvblxuICAgIE86IHBvbHloZWRyb24ub2N0YWhlZHJvblxuICAgIEM6IHBvbHloZWRyb24uY3ViZVxuICAgIEk6IHBvbHloZWRyb24uaWNvc2FoZWRyb25cbiAgICBEOiBwb2x5aGVkcm9uLmRvZGVjYWhlZHJvblxuICAgIFA6IHBvbHloZWRyb24ucHJpc20gICAgICAjIG5cbiAgICBBOiBwb2x5aGVkcm9uLmFudGlwcmlzbSAgIyBuXG4gICAgWTogcG9seWhlZHJvbi5weXJhbWlkICAgICMgblxuICAgIEo6IHBvbHloZWRyb24uam9obnNvbiAgICAjIG5cbiAgICBVOiBwb2x5aGVkcm9uLmN1cG9sYSAgICAgIyBuXG4gICAgVjogcG9seWhlZHJvbi5hbnRpY3Vwb2xhICMgblxuICAgIFxudG9wbyA9IHJlcXVpcmUgJy4vdG9wbydcbiAgICBcbm9wbWFwID1cbiAgICBkOiB0b3BvLmR1YWxcbiAgICBhOiB0b3BvLmFtYm9cbiAgICBrOiB0b3BvLmtpc05cbiAgICBnOiB0b3BvLmd5cm9cbiAgICBwOiB0b3BvLnByb3BlbGxvclxuICAgIHI6IHRvcG8ucmVmbGVjdFxuICAgIGM6IHRvcG8uY2hhbWZlclxuICAgIHc6IHRvcG8ud2hpcmxcbiAgICBuOiB0b3BvLmluc2V0TlxuICAgIHg6IHRvcG8uZXh0cnVkZU5cbiAgICBsOiB0b3BvLmxvZnRcbiAgICBQOiB0b3BvLnBlcnNwZWN0aXZhMVxuICAgIHE6IHRvcG8ucXVpbnRvXG4gICAgdTogdG9wby50cmlzdWJcbiAgICBIOiB0b3BvLmhvbGxvd1xuICAgIFo6IHRvcG8udHJpYW5ndWxhdGVcbiAgICBDOiB0b3BvLmNhbm9uaWNhbGl6ZVxuICAgIEE6IHRvcG8uYWRqdXN0WFlcblxuIyBsaXN0IG9mIGJhc2ljIGVxdWl2YWxlbmNlcywgZWFzaWVyIHRvIHJlcGxhY2UgYmVmb3JlIHBhcnNpbmdcbnNwZWNyZXBsYWNlbWVudHMgPSBbXG4gICAgWy9lL2csIFwiYWFcIl0gICAjIGUgLS0+IGFhICAgKGFiYnIuIGZvciBleHBsb2RlKVxuICAgIFsvYi9nLCBcInRhXCJdICAgIyBiIC0tPiB0YSAgIChhYmJyLiBmb3IgYmV2ZWwpXG4gICAgWy9vL2csIFwiampcIl0gICAjIG8gLS0+IGpqICAgKGFiYnIuIGZvciBvcnRobylcbiAgICBbL20vZywgXCJralwiXSAgICMgbSAtLT4ga2ogICAoYWJici4gZm9yIG1ldGEpXG4gICAgWy90KFxcZCopL2csIFwiZGskMWRcIl0sICAjIHQobikgLS0+IGRrKG4pZCAgKGR1YWwgb3BlcmF0aW9ucylcbiAgICBbL2ovZywgXCJkYWRcIl0gICMgaiAtLT4gZGFkICAoZHVhbCBvcGVyYXRpb25zKSAjIFdoeSBub3QgaiAtLT4gZGEgP1xuICAgIFsvcy9nLCBcImRnZFwiXSAgIyBzIC0tPiBkZ2QgIChkdWFsIG9wZXJhdGlvbnMpICMgV2h5IG5vdCBzIC0tPiBkZyA/XG4gICAgWy9kZC9nLCBcIlwiXSAgICAjIGRkIC0tPiBudWxsICAob3JkZXIgMilcbiAgICBbL2FkL2csIFwiYVwiXSAgICMgYWQgLS0+IGEgICAoYV8gPSBhZF8pXG4gICAgWy9nZC9nLCBcImdcIl0gICAjIGdkIC0tPiBnICAgKGdfID0gZ2RfKVxuICAgIFsvYU8vZywgXCJhQ1wiXSAgIyBhTyAtLT4gYUMgIChmb3IgdW5pcXVlbmVzcylcbiAgICBbL2FJL2csIFwiYURcIl0gICMgYUkgLS0+IGFEICAoZm9yIHVuaXF1ZW5lc3MpXG4gICAgWy9nTy9nLCBcImdDXCJdICAjIGdPIC0tPiBnQyAgKGZvciB1bmlxdWVuZXNzKVxuICAgIFsvZ0kvZywgXCJnRFwiXSAgIyBnSSAtLT4gZ0QgIChmb3IgdW5pcXVlbmVzcylcbl1cblxuZ2V0T3BzID0gKG5vdGF0aW9uKSAtPlxuICAgIFxuICAgIGV4cGFuZGVkID0gbm90YXRpb25cbiAgICBmb3IgW29yaWcsZXF1aXZdIGluIHNwZWNyZXBsYWNlbWVudHNcbiAgICAgICAgZXhwYW5kZWQgPSBleHBhbmRlZC5yZXBsYWNlIG9yaWcsIGVxdWl2XG4gICAgY29uc29sZS5sb2cgXCIje25vdGF0aW9ufSBleGVjdXRlZCBhcyAje2V4cGFuZGVkfVwiXG4gICAgZXhwYW5kZWRcblxuZ2VuZXJhdGVQb2x5ID0gKG5vdGF0aW9uKSAtPiAjIGNyZWF0ZSBwb2x5aGVkcm9uIGZyb20gbm90YXRpb25cbiAgXG4gICAgZGlzcGF0Y2ggPSAoZm4sIGFyZ3MpIC0+IGZuLmFwcGx5IGZuLCBhcmdzIG9yIFtdXG4gICAgXG4gICAgb3BzX3NwZWMgPSBnZXRPcHMgbm90YXRpb25cbiAgICBvcGxpc3QgPSBwYXJzZXIucGFyc2Uob3BzX3NwZWMpLnJldmVyc2UoKVxuICBcbiAgICBvcCA9IG9wbGlzdC5zaGlmdCgpXG4gICAgYmFzZWZ1bmMgPSBiYXNlbWFwW29wW1wib3BcIl1dXG4gICAgYmFzZWFyZ3MgPSBvcFtcImFyZ3NcIl1cbiAgICBwb2x5ID0gZGlzcGF0Y2ggYmFzZWZ1bmMsIGJhc2VhcmdzXG4gIFxuICAgIGZvciBvcCBpbiBvcGxpc3RcbiAgICAgICAgb3BmdW5jID0gb3BtYXBbb3BbXCJvcFwiXV1cbiAgICAgICAgb3BhcmdzID0gW3BvbHldLmNvbmNhdCBvcFtcImFyZ3NcIl1cbiAgICAgICAgcG9seSA9IGRpc3BhdGNoIG9wZnVuYywgb3BhcmdzXG4gIFxuICAgICMgUmVjZW50ZXIgcG9seWhlZHJhIGF0IG9yaWdpbiAocmFyZWx5IG5lZWRlZClcbiAgICBwb2x5LnZlcnRpY2VzID0gcmVjZW50ZXIgcG9seS52ZXJ0aWNlcywgcG9seS5lZGdlcygpXG4gICAgcG9seS52ZXJ0aWNlcyA9IHJlc2NhbGUgcG9seS52ZXJ0aWNlc1xuICBcbiAgICAjIENvbG9yIHRoZSBmYWNlcyBvZiB0aGUgcG9seWhlZHJhIGZvciBkaXNwbGF5XG4gICAgcG9seSA9IHBhaW50UG9seWhlZHJvbiBwb2x5XG5cbmdlbmVyYXRlUG9seSAndFQnXG4gICAgIl19
//# sourceURL=../../coffee/polyhedronisme/parser.coffee